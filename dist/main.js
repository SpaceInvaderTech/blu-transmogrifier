var K8=Object.create;var{defineProperty:N0,getPrototypeOf:S8,getOwnPropertyNames:V8}=Object;var E8=Object.prototype.hasOwnProperty;var F8=(X,J,Y)=>{Y=X!=null?K8(S8(X)):{};const G=J||!X||!X.__esModule?N0(Y,"default",{value:X,enumerable:!0}):Y;for(let Q of V8(X))if(!E8.call(G,Q))N0(G,Q,{get:()=>X[Q],enumerable:!0});return G};var L=(X,J)=>()=>(J||X((J={exports:{}}).exports,J),J.exports);var V0=L((b8,S0)=>{var I8=function(X,J){var Y=new Array(arguments.length-1),G=0,Q=2,T=!0;while(Q<arguments.length)Y[G++]=arguments[Q++];return new Promise(function Z(D,N){Y[G]=function M(H){if(T)if(T=!1,H)N(H);else{var I=new Array(arguments.length-1),k=0;while(k<I.length)I[k++]=arguments[k];D.apply(null,I)}};try{X.apply(J||null,Y)}catch(M){if(T)T=!1,N(M)}})};S0.exports=I8});var O0=L((L0)=>{var b=L0;b.length=function X(J){var Y=J.length;if(!Y)return 0;var G=0;while(--Y%4>1&&J.charAt(Y)==="=")++G;return Math.ceil(J.length*3)/4-G};var j=new Array(64),F0=new Array(123);for(P=0;P<64;)F0[j[P]=P<26?P+65:P<52?P+71:P<62?P-4:P-59|43]=P++;var P;b.encode=function X(J,Y,G){var Q=null,T=[],Z=0,D=0,N;while(Y<G){var M=J[Y++];switch(D){case 0:T[Z++]=j[M>>2],N=(M&3)<<4,D=1;break;case 1:T[Z++]=j[N|M>>4],N=(M&15)<<2,D=2;break;case 2:T[Z++]=j[N|M>>6],T[Z++]=j[M&63],D=0;break}if(Z>8191)(Q||(Q=[])).push(String.fromCharCode.apply(String,T)),Z=0}if(D){if(T[Z++]=j[N],T[Z++]=61,D===1)T[Z++]=61}if(Q){if(Z)Q.push(String.fromCharCode.apply(String,T.slice(0,Z)));return Q.join("")}return String.fromCharCode.apply(String,T.slice(0,Z))};var E0="invalid encoding";b.decode=function X(J,Y,G){var Q=G,T=0,Z;for(var D=0;D<J.length;){var N=J.charCodeAt(D++);if(N===61&&T>1)break;if((N=F0[N])===void 0)throw Error(E0);switch(T){case 0:Z=N,T=1;break;case 1:Y[G++]=Z<<2|(N&48)>>4,Z=N,T=2;break;case 2:Y[G++]=(Z&15)<<4|(N&60)>>2,Z=N,T=3;break;case 3:Y[G++]=(Z&3)<<6|N,T=0;break}}if(T===1)throw Error(E0);return G-Q};b.test=function X(J){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(J)}});var I0=L((l8,z0)=>{var p=function(){this._listeners={}};z0.exports=p;p.prototype.on=function X(J,Y,G){return(this._listeners[J]||(this._listeners[J]=[])).push({fn:Y,ctx:G||this}),this};p.prototype.off=function X(J,Y){if(J===void 0)this._listeners={};else if(Y===void 0)this._listeners[J]=[];else{var G=this._listeners[J];for(var Q=0;Q<G.length;)if(G[Q].fn===Y)G.splice(Q,1);else++Q}return this};p.prototype.emit=function X(J){var Y=this._listeners[J];if(Y){var G=[],Q=1;for(;Q<arguments.length;)G.push(arguments[Q++]);for(Q=0;Q<Y.length;)Y[Q].fn.apply(Y[Q++].ctx,G)}return this}});var k0=L((u8,R0)=>{var _0=function(X){if(typeof Float32Array!=="undefined")(function(){var J=new Float32Array([-0]),Y=new Uint8Array(J.buffer),G=Y[3]===128;function Q(N,M,H){J[0]=N,M[H]=Y[0],M[H+1]=Y[1],M[H+2]=Y[2],M[H+3]=Y[3]}function T(N,M,H){J[0]=N,M[H]=Y[3],M[H+1]=Y[2],M[H+2]=Y[1],M[H+3]=Y[0]}X.writeFloatLE=G?Q:T,X.writeFloatBE=G?T:Q;function Z(N,M){return Y[0]=N[M],Y[1]=N[M+1],Y[2]=N[M+2],Y[3]=N[M+3],J[0]}function D(N,M){return Y[3]=N[M],Y[2]=N[M+1],Y[1]=N[M+2],Y[0]=N[M+3],J[0]}X.readFloatLE=G?Z:D,X.readFloatBE=G?D:Z})();else(function(){function J(G,Q,T,Z){var D=Q<0?1:0;if(D)Q=-Q;if(Q===0)G(1/Q>0?0:2147483648,T,Z);else if(isNaN(Q))G(2143289344,T,Z);else if(Q>340282346638528860000000000000000000000)G((D<<31|2139095040)>>>0,T,Z);else if(Q<0.000000000000000000000000000000000000011754943508222875)G((D<<31|Math.round(Q/0.000000000000000000000000000000000000000000001401298464324817))>>>0,T,Z);else{var N=Math.floor(Math.log(Q)/Math.LN2),M=Math.round(Q*Math.pow(2,-N)*8388608)&8388607;G((D<<31|N+127<<23|M)>>>0,T,Z)}}X.writeFloatLE=J.bind(null,W0),X.writeFloatBE=J.bind(null,P0);function Y(G,Q,T){var Z=G(Q,T),D=(Z>>31)*2+1,N=Z>>>23&255,M=Z&8388607;return N===255?M?NaN:D*Infinity:N===0?D*0.000000000000000000000000000000000000000000001401298464324817*M:D*Math.pow(2,N-150)*(M+8388608)}X.readFloatLE=Y.bind(null,C0),X.readFloatBE=Y.bind(null,U0)})();if(typeof Float64Array!=="undefined")(function(){var J=new Float64Array([-0]),Y=new Uint8Array(J.buffer),G=Y[7]===128;function Q(N,M,H){J[0]=N,M[H]=Y[0],M[H+1]=Y[1],M[H+2]=Y[2],M[H+3]=Y[3],M[H+4]=Y[4],M[H+5]=Y[5],M[H+6]=Y[6],M[H+7]=Y[7]}function T(N,M,H){J[0]=N,M[H]=Y[7],M[H+1]=Y[6],M[H+2]=Y[5],M[H+3]=Y[4],M[H+4]=Y[3],M[H+5]=Y[2],M[H+6]=Y[1],M[H+7]=Y[0]}X.writeDoubleLE=G?Q:T,X.writeDoubleBE=G?T:Q;function Z(N,M){return Y[0]=N[M],Y[1]=N[M+1],Y[2]=N[M+2],Y[3]=N[M+3],Y[4]=N[M+4],Y[5]=N[M+5],Y[6]=N[M+6],Y[7]=N[M+7],J[0]}function D(N,M){return Y[7]=N[M],Y[6]=N[M+1],Y[5]=N[M+2],Y[4]=N[M+3],Y[3]=N[M+4],Y[2]=N[M+5],Y[1]=N[M+6],Y[0]=N[M+7],J[0]}X.readDoubleLE=G?Z:D,X.readDoubleBE=G?D:Z})();else(function(){function J(G,Q,T,Z,D,N){var M=Z<0?1:0;if(M)Z=-Z;if(Z===0)G(0,D,N+Q),G(1/Z>0?0:2147483648,D,N+T);else if(isNaN(Z))G(0,D,N+Q),G(2146959360,D,N+T);else if(Z>179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000)G(0,D,N+Q),G((M<<31|2146435072)>>>0,D,N+T);else{var H;if(Z<0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022250738585072014)H=Z/0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005,G(H>>>0,D,N+Q),G((M<<31|H/4294967296)>>>0,D,N+T);else{var I=Math.floor(Math.log(Z)/Math.LN2);if(I===1024)I=1023;H=Z*Math.pow(2,-I),G(H*4503599627370496>>>0,D,N+Q),G((M<<31|I+1023<<20|H*1048576&1048575)>>>0,D,N+T)}}}X.writeDoubleLE=J.bind(null,W0,0,4),X.writeDoubleBE=J.bind(null,P0,4,0);function Y(G,Q,T,Z,D){var N=G(Z,D+Q),M=G(Z,D+T),H=(M>>31)*2+1,I=M>>>20&2047,k=4294967296*(M&1048575)+N;return I===2047?k?NaN:H*Infinity:I===0?H*0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005*k:H*Math.pow(2,I-1075)*(k+4503599627370496)}X.readDoubleLE=Y.bind(null,C0,0,4),X.readDoubleBE=Y.bind(null,U0,4,0)})();return X},W0=function(X,J,Y){J[Y]=X&255,J[Y+1]=X>>>8&255,J[Y+2]=X>>>16&255,J[Y+3]=X>>>24},P0=function(X,J,Y){J[Y]=X>>>24,J[Y+1]=X>>>16&255,J[Y+2]=X>>>8&255,J[Y+3]=X&255},C0=function(X,J){return(X[J]|X[J+1]<<8|X[J+2]<<16|X[J+3]<<24)>>>0},U0=function(X,J){return(X[J]<<24|X[J+1]<<16|X[J+2]<<8|X[J+3])>>>0};R0.exports=_0(_0)});var x0=L((g8,B0)=>{var _8=function(X){try{var J=(0, eval)("quire".replace(/^/,"re"))(X);if(J&&(J.length||Object.keys(J).length))return J}catch(Y){}return null};B0.exports=_8});var $0=L((h0)=>{var f=h0;f.length=function X(J){var Y=0,G=0;for(var Q=0;Q<J.length;++Q)if(G=J.charCodeAt(Q),G<128)Y+=1;else if(G<2048)Y+=2;else if((G&64512)===55296&&(J.charCodeAt(Q+1)&64512)===56320)++Q,Y+=4;else Y+=3;return Y};f.read=function X(J,Y,G){var Q=G-Y;if(Q<1)return"";var T=null,Z=[],D=0,N;while(Y<G){if(N=J[Y++],N<128)Z[D++]=N;else if(N>191&&N<224)Z[D++]=(N&31)<<6|J[Y++]&63;else if(N>239&&N<365)N=((N&7)<<18|(J[Y++]&63)<<12|(J[Y++]&63)<<6|J[Y++]&63)-65536,Z[D++]=55296+(N>>10),Z[D++]=56320+(N&1023);else Z[D++]=(N&15)<<12|(J[Y++]&63)<<6|J[Y++]&63;if(D>8191)(T||(T=[])).push(String.fromCharCode.apply(String,Z)),D=0}if(T){if(D)T.push(String.fromCharCode.apply(String,Z.slice(0,D)));return T.join("")}return String.fromCharCode.apply(String,Z.slice(0,D))};f.write=function X(J,Y,G){var Q=G,T,Z;for(var D=0;D<J.length;++D)if(T=J.charCodeAt(D),T<128)Y[G++]=T;else if(T<2048)Y[G++]=T>>6|192,Y[G++]=T&63|128;else if((T&64512)===55296&&((Z=J.charCodeAt(D+1))&64512)===56320)T=65536+((T&1023)<<10)+(Z&1023),++D,Y[G++]=T>>18|240,Y[G++]=T>>12&63|128,Y[G++]=T>>6&63|128,Y[G++]=T&63|128;else Y[G++]=T>>12|224,Y[G++]=T>>6&63|128,Y[G++]=T&63|128;return G-Q}});var w0=L((m8,y0)=>{var W8=function(X,J,Y){var G=Y||8192,Q=G>>>1,T=null,Z=G;return function D(N){if(N<1||N>Q)return X(N);if(Z+N>G)T=X(G),Z=0;var M=J.call(T,Z,Z+=N);if(Z&7)Z=(Z|7)+1;return M}};y0.exports=W8});var c0=L((i8,j0)=>{var F=function(X,J){this.lo=X>>>0,this.hi=J>>>0};j0.exports=F;var v=x(),$=F.zero=new F(0,0);$.toNumber=function(){return 0};$.zzEncode=$.zzDecode=function(){return this};$.length=function(){return 1};var P8=F.zeroHash="\0\0\0\0\0\0\0\0";F.fromNumber=function X(J){if(J===0)return $;var Y=J<0;if(Y)J=-J;var G=J>>>0,Q=(J-G)/4294967296>>>0;if(Y){if(Q=~Q>>>0,G=~G>>>0,++G>4294967295){if(G=0,++Q>4294967295)Q=0}}return new F(G,Q)};F.from=function X(J){if(typeof J==="number")return F.fromNumber(J);if(v.isString(J))if(v.Long)J=v.Long.fromString(J);else return F.fromNumber(parseInt(J,10));return J.low||J.high?new F(J.low>>>0,J.high>>>0):$};F.prototype.toNumber=function X(J){if(!J&&this.hi>>>31){var Y=~this.lo+1>>>0,G=~this.hi>>>0;if(!Y)G=G+1>>>0;return-(Y+G*4294967296)}return this.lo+this.hi*4294967296};F.prototype.toLong=function X(J){return v.Long?new v.Long(this.lo|0,this.hi|0,Boolean(J)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(J)}};var B=String.prototype.charCodeAt;F.fromHash=function X(J){if(J===P8)return $;return new F((B.call(J,0)|B.call(J,1)<<8|B.call(J,2)<<16|B.call(J,3)<<24)>>>0,(B.call(J,4)|B.call(J,5)<<8|B.call(J,6)<<16|B.call(J,7)<<24)>>>0)};F.prototype.toHash=function X(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};F.prototype.zzEncode=function X(){var J=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^J)>>>0,this.lo=(this.lo<<1^J)>>>0,this};F.prototype.zzDecode=function X(){var J=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^J)>>>0,this.hi=(this.hi>>>1^J)>>>0,this};F.prototype.length=function X(){var J=this.lo,Y=(this.lo>>>28|this.hi<<4)>>>0,G=this.hi>>>24;return G===0?Y===0?J<16384?J<128?1:2:J<2097152?3:4:Y<16384?Y<128?5:6:Y<2097152?7:8:G<128?9:10}});var x=L((m)=>{var v0=function(X,J,Y){for(var G=Object.keys(J),Q=0;Q<G.length;++Q)if(X[G[Q]]===void 0||!Y)X[G[Q]]=J[G[Q]];return X},n0=function(X){function J(Y,G){if(!(this instanceof J))return new J(Y,G);if(Object.defineProperty(this,"message",{get:function(){return Y}}),Error.captureStackTrace)Error.captureStackTrace(this,J);else Object.defineProperty(this,"stack",{value:new Error().stack||""});if(G)v0(this,G)}return J.prototype=Object.create(Error.prototype,{constructor:{value:J,writable:!0,enumerable:!1,configurable:!0},name:{get:function Y(){return X},set:void 0,enumerable:!1,configurable:!0},toString:{value:function Y(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),J},A=m;A.asPromise=V0();A.base64=O0();A.EventEmitter=I0();A.float=k0();A.inquire=x0();A.utf8=$0();A.pool=w0();A.LongBits=c0();A.isNode=Boolean(typeof global!=="undefined"&&global&&global.process&&global.process.versions&&global.process.versions.node);A.global=A.isNode&&global||typeof window!=="undefined"&&window||typeof self!=="undefined"&&self||m;A.emptyArray=Object.freeze?Object.freeze([]):[];A.emptyObject=Object.freeze?Object.freeze({}):{};A.isInteger=Number.isInteger||function X(J){return typeof J==="number"&&isFinite(J)&&Math.floor(J)===J};A.isString=function X(J){return typeof J==="string"||J instanceof String};A.isObject=function X(J){return J&&typeof J==="object"};A.isset=A.isSet=function X(J,Y){var G=J[Y];if(G!=null&&J.hasOwnProperty(Y))return typeof G!=="object"||(Array.isArray(G)?G.length:Object.keys(G).length)>0;return!1};A.Buffer=function(){try{var X=A.inquire("buffer").Buffer;return X.prototype.utf8Write?X:null}catch(J){return null}}();A._Buffer_from=null;A._Buffer_allocUnsafe=null;A.newBuffer=function X(J){return typeof J==="number"?A.Buffer?A._Buffer_allocUnsafe(J):new A.Array(J):A.Buffer?A._Buffer_from(J):typeof Uint8Array==="undefined"?J:new Uint8Array(J)};A.Array=typeof Uint8Array!=="undefined"?Uint8Array:Array;A.Long=A.global.dcodeIO&&A.global.dcodeIO.Long||A.global.Long||A.inquire("long");A.key2Re=/^true|false|0|1$/;A.key32Re=/^-?(?:0|[1-9][0-9]*)$/;A.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;A.longToHash=function X(J){return J?A.LongBits.from(J).toHash():A.LongBits.zeroHash};A.longFromHash=function X(J,Y){var G=A.LongBits.fromHash(J);if(A.Long)return A.Long.fromBits(G.lo,G.hi,Y);return G.toNumber(Boolean(Y))};A.merge=v0;A.lcFirst=function X(J){return J.charAt(0).toLowerCase()+J.substring(1)};A.newError=n0;A.ProtocolError=n0("ProtocolError");A.oneOfGetter=function X(J){var Y={};for(var G=0;G<J.length;++G)Y[J[G]]=1;return function(){for(var Q=Object.keys(this),T=Q.length-1;T>-1;--T)if(Y[Q[T]]===1&&this[Q[T]]!==void 0&&this[Q[T]]!==null)return Q[T]}};A.oneOfSetter=function X(J){return function(Y){for(var G=0;G<J.length;++G)if(J[G]!==Y)delete this[J[G]]}};A.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};A._configure=function(){var X=A.Buffer;if(!X){A._Buffer_from=A._Buffer_allocUnsafe=null;return}A._Buffer_from=X.from!==Uint8Array.from&&X.from||function J(Y,G){return new X(Y,G)},A._Buffer_allocUnsafe=X.allocUnsafe||function J(Y){return new X(Y)}}});var e=L((t8,l0)=>{var n=function(X,J,Y){this.fn=X,this.len=J,this.next=void 0,this.val=Y},t=function(){},C8=function(X){this.head=X.head,this.tail=X.tail,this.len=X.len,this.next=X.states},S=function(){this.len=0,this.head=new n(t,0,0),this.tail=this.head,this.states=null},a=function(X,J,Y){J[Y]=X&255},U8=function(X,J,Y){while(X>127)J[Y++]=X&127|128,X>>>=7;J[Y]=X},r=function(X,J){this.len=X,this.next=void 0,this.val=J},s=function(X,J,Y){while(X.hi)J[Y++]=X.lo&127|128,X.lo=(X.lo>>>7|X.hi<<25)>>>0,X.hi>>>=7;while(X.lo>127)J[Y++]=X.lo&127|128,X.lo=X.lo>>>7;J[Y++]=X.lo},o=function(X,J,Y){J[Y]=X&255,J[Y+1]=X>>>8&255,J[Y+2]=X>>>16&255,J[Y+3]=X>>>24};l0.exports=S;var W=x(),i,l=W.LongBits,d0=W.base64,b0=W.utf8,p0=function X(){return W.Buffer?function J(){return(S.create=function Y(){return new i})()}:function J(){return new S}};S.create=p0();S.alloc=function X(J){return new W.Array(J)};if(W.Array!==Array)S.alloc=W.pool(S.alloc,W.Array.prototype.subarray);S.prototype._push=function X(J,Y,G){return this.tail=this.tail.next=new n(J,Y,G),this.len+=Y,this};r.prototype=Object.create(n.prototype);r.prototype.fn=U8;S.prototype.uint32=function X(J){return this.len+=(this.tail=this.tail.next=new r((J=J>>>0)<128?1:J<16384?2:J<2097152?3:J<268435456?4:5,J)).len,this};S.prototype.int32=function X(J){return J<0?this._push(s,10,l.fromNumber(J)):this.uint32(J)};S.prototype.sint32=function X(J){return this.uint32((J<<1^J>>31)>>>0)};S.prototype.uint64=function X(J){var Y=l.from(J);return this._push(s,Y.length(),Y)};S.prototype.int64=S.prototype.uint64;S.prototype.sint64=function X(J){var Y=l.from(J).zzEncode();return this._push(s,Y.length(),Y)};S.prototype.bool=function X(J){return this._push(a,1,J?1:0)};S.prototype.fixed32=function X(J){return this._push(o,4,J>>>0)};S.prototype.sfixed32=S.prototype.fixed32;S.prototype.fixed64=function X(J){var Y=l.from(J);return this._push(o,4,Y.lo)._push(o,4,Y.hi)};S.prototype.sfixed64=S.prototype.fixed64;S.prototype.float=function X(J){return this._push(W.float.writeFloatLE,4,J)};S.prototype.double=function X(J){return this._push(W.float.writeDoubleLE,8,J)};var R8=W.Array.prototype.set?function X(J,Y,G){Y.set(J,G)}:function X(J,Y,G){for(var Q=0;Q<J.length;++Q)Y[G+Q]=J[Q]};S.prototype.bytes=function X(J){var Y=J.length>>>0;if(!Y)return this._push(a,1,0);if(W.isString(J)){var G=S.alloc(Y=d0.length(J));d0.decode(J,G,0),J=G}return this.uint32(Y)._push(R8,Y,J)};S.prototype.string=function X(J){var Y=b0.length(J);return Y?this.uint32(Y)._push(b0.write,Y,J):this._push(a,1,0)};S.prototype.fork=function X(){return this.states=new C8(this),this.head=this.tail=new n(t,0,0),this.len=0,this};S.prototype.reset=function X(){if(this.states)this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next;else this.head=this.tail=new n(t,0,0),this.len=0;return this};S.prototype.ldelim=function X(){var J=this.head,Y=this.tail,G=this.len;if(this.reset().uint32(G),G)this.tail.next=J.next,this.tail=Y,this.len+=G;return this};S.prototype.finish=function X(){var J=this.head.next,Y=this.constructor.alloc(this.len),G=0;while(J)J.fn(J.val,Y,G),G+=J.len,J=J.next;return Y};S._configure=function(X){i=X,S.create=p0(),i._configure()}});var f0=L((a8,g0)=>{var R=function(){u0.call(this)},k8=function(X,J,Y){if(X.length<40)h.utf8.write(X,J,Y);else if(J.utf8Write)J.utf8Write(X,Y);else J.write(X,Y)};g0.exports=R;var u0=e();(R.prototype=Object.create(u0.prototype)).constructor=R;var h=x();R._configure=function(){R.alloc=h._Buffer_allocUnsafe,R.writeBytesBuffer=h.Buffer&&h.Buffer.prototype instanceof Uint8Array&&h.Buffer.prototype.set.name==="set"?function X(J,Y,G){Y.set(J,G)}:function X(J,Y,G){if(J.copy)J.copy(Y,G,0,J.length);else for(var Q=0;Q<J.length;)Y[G++]=J[Q++]}};R.prototype.bytes=function X(J){if(h.isString(J))J=h._Buffer_from(J,"base64");var Y=J.length>>>0;if(this.uint32(Y),Y)this._push(R.writeBytesBuffer,Y,J);return this};R.prototype.string=function X(J){var Y=h.Buffer.byteLength(J);if(this.uint32(Y),Y)this._push(k8,Y,J);return this};R._configure()});var Q0=L((r8,a0)=>{var U=function(X,J){return RangeError("index out of range: "+X.pos+" + "+(J||1)+" > "+X.len)},E=function(X){this.buf=X,this.pos=0,this.len=X.length},G0=function(){var X=new o0(0,0),J=0;if(this.len-this.pos>4){for(;J<4;++J)if(X.lo=(X.lo|(this.buf[this.pos]&127)<<J*7)>>>0,this.buf[this.pos++]<128)return X;if(X.lo=(X.lo|(this.buf[this.pos]&127)<<28)>>>0,X.hi=(X.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return X;J=0}else{for(;J<3;++J){if(this.pos>=this.len)throw U(this);if(X.lo=(X.lo|(this.buf[this.pos]&127)<<J*7)>>>0,this.buf[this.pos++]<128)return X}return X.lo=(X.lo|(this.buf[this.pos++]&127)<<J*7)>>>0,X}if(this.len-this.pos>4){for(;J<5;++J)if(X.hi=(X.hi|(this.buf[this.pos]&127)<<J*7+3)>>>0,this.buf[this.pos++]<128)return X}else for(;J<5;++J){if(this.pos>=this.len)throw U(this);if(X.hi=(X.hi|(this.buf[this.pos]&127)<<J*7+3)>>>0,this.buf[this.pos++]<128)return X}throw Error("invalid varint encoding")},u=function(X,J){return(X[J-4]|X[J-3]<<8|X[J-2]<<16|X[J-1]<<24)>>>0},i0=function(){if(this.pos+8>this.len)throw U(this,8);return new o0(u(this.buf,this.pos+=4),u(this.buf,this.pos+=4))};a0.exports=E;var C=x(),J0,o0=C.LongBits,B8=C.utf8,m0=typeof Uint8Array!=="undefined"?function X(J){if(J instanceof Uint8Array||Array.isArray(J))return new E(J);throw Error("illegal buffer")}:function X(J){if(Array.isArray(J))return new E(J);throw Error("illegal buffer")},t0=function X(){return C.Buffer?function J(Y){return(E.create=function G(Q){return C.Buffer.isBuffer(Q)?new J0(Q):m0(Q)})(Y)}:m0};E.create=t0();E.prototype._slice=C.Array.prototype.subarray||C.Array.prototype.slice;E.prototype.uint32=function X(){var J=4294967295;return function Y(){if(J=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128)return J;if(J=(J|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)return J;if(J=(J|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)return J;if(J=(J|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)return J;if(J=(J|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128)return J;if((this.pos+=5)>this.len)throw this.pos=this.len,U(this,10);return J}}();E.prototype.int32=function X(){return this.uint32()|0};E.prototype.sint32=function X(){var J=this.uint32();return J>>>1^-(J&1)|0};E.prototype.bool=function X(){return this.uint32()!==0};E.prototype.fixed32=function X(){if(this.pos+4>this.len)throw U(this,4);return u(this.buf,this.pos+=4)};E.prototype.sfixed32=function X(){if(this.pos+4>this.len)throw U(this,4);return u(this.buf,this.pos+=4)|0};E.prototype.float=function X(){if(this.pos+4>this.len)throw U(this,4);var J=C.float.readFloatLE(this.buf,this.pos);return this.pos+=4,J};E.prototype.double=function X(){if(this.pos+8>this.len)throw U(this,4);var J=C.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,J};E.prototype.bytes=function X(){var J=this.uint32(),Y=this.pos,G=this.pos+J;if(G>this.len)throw U(this,J);if(this.pos+=J,Array.isArray(this.buf))return this.buf.slice(Y,G);if(Y===G){var Q=C.Buffer;return Q?Q.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,Y,G)};E.prototype.string=function X(){var J=this.bytes();return B8.read(J,0,J.length)};E.prototype.skip=function X(J){if(typeof J==="number"){if(this.pos+J>this.len)throw U(this,J);this.pos+=J}else do if(this.pos>=this.len)throw U(this);while(this.buf[this.pos++]&128);return this};E.prototype.skipType=function(X){switch(X){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while((X=this.uint32()&7)!==4)this.skipType(X);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+X+" at offset "+this.pos)}return this};E._configure=function(X){J0=X,E.create=t0(),J0._configure();var J=C.Long?"toLong":"toNumber";C.merge(E.prototype,{int64:function Y(){return G0.call(this)[J](!1)},uint64:function Y(){return G0.call(this)[J](!0)},sint64:function Y(){return G0.call(this).zzDecode()[J](!1)},fixed64:function Y(){return i0.call(this)[J](!0)},sfixed64:function Y(){return i0.call(this)[J](!1)}})}});var G8=L((s8,e0)=>{var y=function(X){s0.call(this,X)};e0.exports=y;var s0=Q0();(y.prototype=Object.create(s0.prototype)).constructor=y;var r0=x();y._configure=function(){if(r0.Buffer)y.prototype._slice=r0.Buffer.prototype.slice};y.prototype.string=function X(){var J=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+J,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+J,this.len))};y._configure()});var Q8=L((e8,J8)=>{var d=function(X,J,Y){if(typeof X!=="function")throw TypeError("rpcImpl must be a function");Y0.EventEmitter.call(this),this.rpcImpl=X,this.requestDelimited=Boolean(J),this.responseDelimited=Boolean(Y)};J8.exports=d;var Y0=x();(d.prototype=Object.create(Y0.EventEmitter.prototype)).constructor=d;d.prototype.rpcCall=function X(J,Y,G,Q,T){if(!Q)throw TypeError("request must be specified");var Z=this;if(!T)return Y0.asPromise(X,Z,J,Y,G,Q);if(!Z.rpcImpl){setTimeout(function(){T(Error("already ended"))},0);return}try{return Z.rpcImpl(J,Y[Z.requestDelimited?"encodeDelimited":"encode"](Q).finish(),function D(N,M){if(N)return Z.emit("error",N,J),T(N);if(M===null){Z.end(!0);return}if(!(M instanceof G))try{M=G[Z.responseDelimited?"decodeDelimited":"decode"](M)}catch(H){return Z.emit("error",H,J),T(H)}return Z.emit("data",M,J),T(null,M)})}catch(D){Z.emit("error",D,J),setTimeout(function(){T(D)},0);return}};d.prototype.end=function X(J){if(this.rpcImpl){if(!J)this.rpcImpl(null,null,null);this.rpcImpl=null,this.emit("end").off()}return this}});var X8=L((Y8)=>{var x8=Y8;x8.Service=Q8()});var Z8=L((JG,T8)=>{T8.exports={}});var M8=L((D8)=>{var N8=function(){_.util._configure(),_.Writer._configure(_.BufferWriter),_.Reader._configure(_.BufferReader)},_=D8;_.build="minimal";_.Writer=e();_.BufferWriter=f0();_.Reader=Q0();_.BufferReader=G8();_.util=x();_.rpc=X8();_.roots=Z8();_.configure=N8;N8()});import{Buffer as q8} from"node:buffer";var D0=Object.freeze({manifest:{application:{bin_file:"firmware.bin",dat_file:"initpacket.dat"}}});import{Buffer as c} from"node:buffer";import{createECDH as M0,createHash as L8,sign as O8} from"node:crypto";function q0(){const X=M0("secp224r1");return X.generateKeys(),X.getPrivateKey()}function A0(X){const J=M0("secp224r1");J.setPrivateKey(X);const Y=J.getPublicKey(null,"compressed");return c.from(Y.subarray(1))}function H0(X){const J=L8("sha256").update(X).digest();return c.from(J.reverse())}function z8(X){return c.concat([c.from(X.subarray(0,32)).reverse(),c.from(X.subarray(32,64)).reverse()])}function K0(X,J){return z8(O8(null,X,{key:J,dsaEncoding:"ieee-p1363"}))}import{Buffer as h8} from"node:buffer";var O=F8(M8(),1),V=O.Reader,w=O.Writer,K=O.util,q=O.roots.default||(O.roots.default={}),z=q.dfu=(()=>{const X={};return X.OpCode=function(){const J={},Y=Object.create(J);return Y[J[0]="RESET"]=0,Y[J[1]="INIT"]=1,Y}(),X.FwType=function(){const J={},Y=Object.create(J);return Y[J[0]="APPLICATION"]=0,Y[J[1]="SOFTDEVICE"]=1,Y[J[2]="BOOTLOADER"]=2,Y[J[3]="SOFTDEVICE_BOOTLOADER"]=3,Y[J[4]="EXTERNAL_APPLICATION"]=4,Y}(),X.HashType=function(){const J={},Y=Object.create(J);return Y[J[0]="NO_HASH"]=0,Y[J[1]="CRC"]=1,Y[J[2]="SHA128"]=2,Y[J[3]="SHA256"]=3,Y[J[4]="SHA512"]=4,Y}(),X.ValidationType=function(){const J={},Y=Object.create(J);return Y[J[0]="NO_VALIDATION"]=0,Y[J[1]="VALIDATE_GENERATED_CRC"]=1,Y[J[2]="VALIDATE_SHA256"]=2,Y[J[3]="VALIDATE_ECDSA_P256_SHA256"]=3,Y}(),X.Hash=function(){function J(Y){if(Y){for(let G=Object.keys(Y),Q=0;Q<G.length;++Q)if(Y[G[Q]]!=null)this[G[Q]]=Y[G[Q]]}}return J.prototype.hashType=0,J.prototype.hash=K.newBuffer([]),J.create=function Y(G){return new J(G)},J.encode=function Y(G,Q){if(!Q)Q=w.create();return Q.uint32(8).int32(G.hashType),Q.uint32(18).bytes(G.hash),Q},J.encodeDelimited=function Y(G,Q){return this.encode(G,Q).ldelim()},J.decode=function Y(G,Q){if(!(G instanceof V))G=V.create(G);let T=Q===void 0?G.len:G.pos+Q,Z=new q.dfu.Hash;while(G.pos<T){let D=G.uint32();switch(D>>>3){case 1:{Z.hashType=G.int32();break}case 2:{Z.hash=G.bytes();break}default:G.skipType(D&7);break}}if(!Z.hasOwnProperty("hashType"))throw K.ProtocolError("missing required 'hashType'",{instance:Z});if(!Z.hasOwnProperty("hash"))throw K.ProtocolError("missing required 'hash'",{instance:Z});return Z},J.decodeDelimited=function Y(G){if(!(G instanceof V))G=new V(G);return this.decode(G,G.uint32())},J.verify=function Y(G){if(typeof G!=="object"||G===null)return"object expected";switch(G.hashType){default:return"hashType: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(!(G.hash&&typeof G.hash.length==="number"||K.isString(G.hash)))return"hash: buffer expected";return null},J.fromObject=function Y(G){if(G instanceof q.dfu.Hash)return G;let Q=new q.dfu.Hash;switch(G.hashType){default:if(typeof G.hashType==="number"){Q.hashType=G.hashType;break}break;case"NO_HASH":case 0:Q.hashType=0;break;case"CRC":case 1:Q.hashType=1;break;case"SHA128":case 2:Q.hashType=2;break;case"SHA256":case 3:Q.hashType=3;break;case"SHA512":case 4:Q.hashType=4;break}if(G.hash!=null){if(typeof G.hash==="string")K.base64.decode(G.hash,Q.hash=K.newBuffer(K.base64.length(G.hash)),0);else if(G.hash.length>=0)Q.hash=G.hash}return Q},J.toObject=function Y(G,Q){if(!Q)Q={};let T={};if(Q.defaults){if(T.hashType=Q.enums===String?"NO_HASH":0,Q.bytes===String)T.hash="";else if(T.hash=[],Q.bytes!==Array)T.hash=K.newBuffer(T.hash)}if(G.hashType!=null&&G.hasOwnProperty("hashType"))T.hashType=Q.enums===String?q.dfu.HashType[G.hashType]===void 0?G.hashType:q.dfu.HashType[G.hashType]:G.hashType;if(G.hash!=null&&G.hasOwnProperty("hash"))T.hash=Q.bytes===String?K.base64.encode(G.hash,0,G.hash.length):Q.bytes===Array?Array.prototype.slice.call(G.hash):G.hash;return T},J.prototype.toJSON=function Y(){return this.constructor.toObject(this,O.util.toJSONOptions)},J.getTypeUrl=function Y(G){if(G===void 0)G="type.googleapis.com";return G+"/dfu.Hash"},J}(),X.BootValidation=function(){function J(Y){if(Y){for(let G=Object.keys(Y),Q=0;Q<G.length;++Q)if(Y[G[Q]]!=null)this[G[Q]]=Y[G[Q]]}}return J.prototype.type=0,J.prototype.bytes=K.newBuffer([]),J.create=function Y(G){return new J(G)},J.encode=function Y(G,Q){if(!Q)Q=w.create();return Q.uint32(8).int32(G.type),Q.uint32(18).bytes(G.bytes),Q},J.encodeDelimited=function Y(G,Q){return this.encode(G,Q).ldelim()},J.decode=function Y(G,Q){if(!(G instanceof V))G=V.create(G);let T=Q===void 0?G.len:G.pos+Q,Z=new q.dfu.BootValidation;while(G.pos<T){let D=G.uint32();switch(D>>>3){case 1:{Z.type=G.int32();break}case 2:{Z.bytes=G.bytes();break}default:G.skipType(D&7);break}}if(!Z.hasOwnProperty("type"))throw K.ProtocolError("missing required 'type'",{instance:Z});if(!Z.hasOwnProperty("bytes"))throw K.ProtocolError("missing required 'bytes'",{instance:Z});return Z},J.decodeDelimited=function Y(G){if(!(G instanceof V))G=new V(G);return this.decode(G,G.uint32())},J.verify=function Y(G){if(typeof G!=="object"||G===null)return"object expected";switch(G.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:break}if(!(G.bytes&&typeof G.bytes.length==="number"||K.isString(G.bytes)))return"bytes: buffer expected";return null},J.fromObject=function Y(G){if(G instanceof q.dfu.BootValidation)return G;let Q=new q.dfu.BootValidation;switch(G.type){default:if(typeof G.type==="number"){Q.type=G.type;break}break;case"NO_VALIDATION":case 0:Q.type=0;break;case"VALIDATE_GENERATED_CRC":case 1:Q.type=1;break;case"VALIDATE_SHA256":case 2:Q.type=2;break;case"VALIDATE_ECDSA_P256_SHA256":case 3:Q.type=3;break}if(G.bytes!=null){if(typeof G.bytes==="string")K.base64.decode(G.bytes,Q.bytes=K.newBuffer(K.base64.length(G.bytes)),0);else if(G.bytes.length>=0)Q.bytes=G.bytes}return Q},J.toObject=function Y(G,Q){if(!Q)Q={};let T={};if(Q.defaults){if(T.type=Q.enums===String?"NO_VALIDATION":0,Q.bytes===String)T.bytes="";else if(T.bytes=[],Q.bytes!==Array)T.bytes=K.newBuffer(T.bytes)}if(G.type!=null&&G.hasOwnProperty("type"))T.type=Q.enums===String?q.dfu.ValidationType[G.type]===void 0?G.type:q.dfu.ValidationType[G.type]:G.type;if(G.bytes!=null&&G.hasOwnProperty("bytes"))T.bytes=Q.bytes===String?K.base64.encode(G.bytes,0,G.bytes.length):Q.bytes===Array?Array.prototype.slice.call(G.bytes):G.bytes;return T},J.prototype.toJSON=function Y(){return this.constructor.toObject(this,O.util.toJSONOptions)},J.getTypeUrl=function Y(G){if(G===void 0)G="type.googleapis.com";return G+"/dfu.BootValidation"},J}(),X.InitCommand=function(){function J(Y){if(this.sdReq=[],this.bootValidation=[],Y){for(let G=Object.keys(Y),Q=0;Q<G.length;++Q)if(Y[G[Q]]!=null)this[G[Q]]=Y[G[Q]]}}return J.prototype.fwVersion=0,J.prototype.hwVersion=0,J.prototype.sdReq=K.emptyArray,J.prototype.type=0,J.prototype.sdSize=0,J.prototype.blSize=0,J.prototype.appSize=0,J.prototype.hash=null,J.prototype.isDebug=!1,J.prototype.bootValidation=K.emptyArray,J.create=function Y(G){return new J(G)},J.encode=function Y(G,Q){if(!Q)Q=w.create();if(G.fwVersion!=null&&Object.hasOwnProperty.call(G,"fwVersion"))Q.uint32(8).uint32(G.fwVersion);if(G.hwVersion!=null&&Object.hasOwnProperty.call(G,"hwVersion"))Q.uint32(16).uint32(G.hwVersion);if(G.sdReq!=null&&G.sdReq.length){Q.uint32(26).fork();for(let T=0;T<G.sdReq.length;++T)Q.uint32(G.sdReq[T]);Q.ldelim()}if(G.type!=null&&Object.hasOwnProperty.call(G,"type"))Q.uint32(32).int32(G.type);if(G.sdSize!=null&&Object.hasOwnProperty.call(G,"sdSize"))Q.uint32(40).uint32(G.sdSize);if(G.blSize!=null&&Object.hasOwnProperty.call(G,"blSize"))Q.uint32(48).uint32(G.blSize);if(G.appSize!=null&&Object.hasOwnProperty.call(G,"appSize"))Q.uint32(56).uint32(G.appSize);if(G.hash!=null&&Object.hasOwnProperty.call(G,"hash"))q.dfu.Hash.encode(G.hash,Q.uint32(66).fork()).ldelim();if(G.isDebug!=null&&Object.hasOwnProperty.call(G,"isDebug"))Q.uint32(72).bool(G.isDebug);if(G.bootValidation!=null&&G.bootValidation.length)for(let T=0;T<G.bootValidation.length;++T)q.dfu.BootValidation.encode(G.bootValidation[T],Q.uint32(82).fork()).ldelim();return Q},J.encodeDelimited=function Y(G,Q){return this.encode(G,Q).ldelim()},J.decode=function Y(G,Q){if(!(G instanceof V))G=V.create(G);let T=Q===void 0?G.len:G.pos+Q,Z=new q.dfu.InitCommand;while(G.pos<T){let D=G.uint32();switch(D>>>3){case 1:{Z.fwVersion=G.uint32();break}case 2:{Z.hwVersion=G.uint32();break}case 3:{if(!(Z.sdReq&&Z.sdReq.length))Z.sdReq=[];if((D&7)===2){let N=G.uint32()+G.pos;while(G.pos<N)Z.sdReq.push(G.uint32())}else Z.sdReq.push(G.uint32());break}case 4:{Z.type=G.int32();break}case 5:{Z.sdSize=G.uint32();break}case 6:{Z.blSize=G.uint32();break}case 7:{Z.appSize=G.uint32();break}case 8:{Z.hash=q.dfu.Hash.decode(G,G.uint32());break}case 9:{Z.isDebug=G.bool();break}case 10:{if(!(Z.bootValidation&&Z.bootValidation.length))Z.bootValidation=[];Z.bootValidation.push(q.dfu.BootValidation.decode(G,G.uint32()));break}default:G.skipType(D&7);break}}return Z},J.decodeDelimited=function Y(G){if(!(G instanceof V))G=new V(G);return this.decode(G,G.uint32())},J.verify=function Y(G){if(typeof G!=="object"||G===null)return"object expected";if(G.fwVersion!=null&&G.hasOwnProperty("fwVersion")){if(!K.isInteger(G.fwVersion))return"fwVersion: integer expected"}if(G.hwVersion!=null&&G.hasOwnProperty("hwVersion")){if(!K.isInteger(G.hwVersion))return"hwVersion: integer expected"}if(G.sdReq!=null&&G.hasOwnProperty("sdReq")){if(!Array.isArray(G.sdReq))return"sdReq: array expected";for(let Q=0;Q<G.sdReq.length;++Q)if(!K.isInteger(G.sdReq[Q]))return"sdReq: integer[] expected"}if(G.type!=null&&G.hasOwnProperty("type"))switch(G.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(G.sdSize!=null&&G.hasOwnProperty("sdSize")){if(!K.isInteger(G.sdSize))return"sdSize: integer expected"}if(G.blSize!=null&&G.hasOwnProperty("blSize")){if(!K.isInteger(G.blSize))return"blSize: integer expected"}if(G.appSize!=null&&G.hasOwnProperty("appSize")){if(!K.isInteger(G.appSize))return"appSize: integer expected"}if(G.hash!=null&&G.hasOwnProperty("hash")){let Q=q.dfu.Hash.verify(G.hash);if(Q)return"hash."+Q}if(G.isDebug!=null&&G.hasOwnProperty("isDebug")){if(typeof G.isDebug!=="boolean")return"isDebug: boolean expected"}if(G.bootValidation!=null&&G.hasOwnProperty("bootValidation")){if(!Array.isArray(G.bootValidation))return"bootValidation: array expected";for(let Q=0;Q<G.bootValidation.length;++Q){let T=q.dfu.BootValidation.verify(G.bootValidation[Q]);if(T)return"bootValidation."+T}}return null},J.fromObject=function Y(G){if(G instanceof q.dfu.InitCommand)return G;let Q=new q.dfu.InitCommand;if(G.fwVersion!=null)Q.fwVersion=G.fwVersion>>>0;if(G.hwVersion!=null)Q.hwVersion=G.hwVersion>>>0;if(G.sdReq){if(!Array.isArray(G.sdReq))throw TypeError(".dfu.InitCommand.sdReq: array expected");Q.sdReq=[];for(let T=0;T<G.sdReq.length;++T)Q.sdReq[T]=G.sdReq[T]>>>0}switch(G.type){default:if(typeof G.type==="number"){Q.type=G.type;break}break;case"APPLICATION":case 0:Q.type=0;break;case"SOFTDEVICE":case 1:Q.type=1;break;case"BOOTLOADER":case 2:Q.type=2;break;case"SOFTDEVICE_BOOTLOADER":case 3:Q.type=3;break;case"EXTERNAL_APPLICATION":case 4:Q.type=4;break}if(G.sdSize!=null)Q.sdSize=G.sdSize>>>0;if(G.blSize!=null)Q.blSize=G.blSize>>>0;if(G.appSize!=null)Q.appSize=G.appSize>>>0;if(G.hash!=null){if(typeof G.hash!=="object")throw TypeError(".dfu.InitCommand.hash: object expected");Q.hash=q.dfu.Hash.fromObject(G.hash)}if(G.isDebug!=null)Q.isDebug=Boolean(G.isDebug);if(G.bootValidation){if(!Array.isArray(G.bootValidation))throw TypeError(".dfu.InitCommand.bootValidation: array expected");Q.bootValidation=[];for(let T=0;T<G.bootValidation.length;++T){if(typeof G.bootValidation[T]!=="object")throw TypeError(".dfu.InitCommand.bootValidation: object expected");Q.bootValidation[T]=q.dfu.BootValidation.fromObject(G.bootValidation[T])}}return Q},J.toObject=function Y(G,Q){if(!Q)Q={};let T={};if(Q.arrays||Q.defaults)T.sdReq=[],T.bootValidation=[];if(Q.defaults)T.fwVersion=0,T.hwVersion=0,T.type=Q.enums===String?"APPLICATION":0,T.sdSize=0,T.blSize=0,T.appSize=0,T.hash=null,T.isDebug=!1;if(G.fwVersion!=null&&G.hasOwnProperty("fwVersion"))T.fwVersion=G.fwVersion;if(G.hwVersion!=null&&G.hasOwnProperty("hwVersion"))T.hwVersion=G.hwVersion;if(G.sdReq&&G.sdReq.length){T.sdReq=[];for(let Z=0;Z<G.sdReq.length;++Z)T.sdReq[Z]=G.sdReq[Z]}if(G.type!=null&&G.hasOwnProperty("type"))T.type=Q.enums===String?q.dfu.FwType[G.type]===void 0?G.type:q.dfu.FwType[G.type]:G.type;if(G.sdSize!=null&&G.hasOwnProperty("sdSize"))T.sdSize=G.sdSize;if(G.blSize!=null&&G.hasOwnProperty("blSize"))T.blSize=G.blSize;if(G.appSize!=null&&G.hasOwnProperty("appSize"))T.appSize=G.appSize;if(G.hash!=null&&G.hasOwnProperty("hash"))T.hash=q.dfu.Hash.toObject(G.hash,Q);if(G.isDebug!=null&&G.hasOwnProperty("isDebug"))T.isDebug=G.isDebug;if(G.bootValidation&&G.bootValidation.length){T.bootValidation=[];for(let Z=0;Z<G.bootValidation.length;++Z)T.bootValidation[Z]=q.dfu.BootValidation.toObject(G.bootValidation[Z],Q)}return T},J.prototype.toJSON=function Y(){return this.constructor.toObject(this,O.util.toJSONOptions)},J.getTypeUrl=function Y(G){if(G===void 0)G="type.googleapis.com";return G+"/dfu.InitCommand"},J}(),X.ResetCommand=function(){function J(Y){if(Y){for(let G=Object.keys(Y),Q=0;Q<G.length;++Q)if(Y[G[Q]]!=null)this[G[Q]]=Y[G[Q]]}}return J.prototype.timeout=0,J.create=function Y(G){return new J(G)},J.encode=function Y(G,Q){if(!Q)Q=w.create();return Q.uint32(8).uint32(G.timeout),Q},J.encodeDelimited=function Y(G,Q){return this.encode(G,Q).ldelim()},J.decode=function Y(G,Q){if(!(G instanceof V))G=V.create(G);let T=Q===void 0?G.len:G.pos+Q,Z=new q.dfu.ResetCommand;while(G.pos<T){let D=G.uint32();switch(D>>>3){case 1:{Z.timeout=G.uint32();break}default:G.skipType(D&7);break}}if(!Z.hasOwnProperty("timeout"))throw K.ProtocolError("missing required 'timeout'",{instance:Z});return Z},J.decodeDelimited=function Y(G){if(!(G instanceof V))G=new V(G);return this.decode(G,G.uint32())},J.verify=function Y(G){if(typeof G!=="object"||G===null)return"object expected";if(!K.isInteger(G.timeout))return"timeout: integer expected";return null},J.fromObject=function Y(G){if(G instanceof q.dfu.ResetCommand)return G;let Q=new q.dfu.ResetCommand;if(G.timeout!=null)Q.timeout=G.timeout>>>0;return Q},J.toObject=function Y(G,Q){if(!Q)Q={};let T={};if(Q.defaults)T.timeout=0;if(G.timeout!=null&&G.hasOwnProperty("timeout"))T.timeout=G.timeout;return T},J.prototype.toJSON=function Y(){return this.constructor.toObject(this,O.util.toJSONOptions)},J.getTypeUrl=function Y(G){if(G===void 0)G="type.googleapis.com";return G+"/dfu.ResetCommand"},J}(),X.Command=function(){function J(Y){if(Y){for(let G=Object.keys(Y),Q=0;Q<G.length;++Q)if(Y[G[Q]]!=null)this[G[Q]]=Y[G[Q]]}}return J.prototype.opCode=0,J.prototype.init=null,J.prototype.reset=null,J.create=function Y(G){return new J(G)},J.encode=function Y(G,Q){if(!Q)Q=w.create();if(G.opCode!=null&&Object.hasOwnProperty.call(G,"opCode"))Q.uint32(8).int32(G.opCode);if(G.init!=null&&Object.hasOwnProperty.call(G,"init"))q.dfu.InitCommand.encode(G.init,Q.uint32(18).fork()).ldelim();if(G.reset!=null&&Object.hasOwnProperty.call(G,"reset"))q.dfu.ResetCommand.encode(G.reset,Q.uint32(26).fork()).ldelim();return Q},J.encodeDelimited=function Y(G,Q){return this.encode(G,Q).ldelim()},J.decode=function Y(G,Q){if(!(G instanceof V))G=V.create(G);let T=Q===void 0?G.len:G.pos+Q,Z=new q.dfu.Command;while(G.pos<T){let D=G.uint32();switch(D>>>3){case 1:{Z.opCode=G.int32();break}case 2:{Z.init=q.dfu.InitCommand.decode(G,G.uint32());break}case 3:{Z.reset=q.dfu.ResetCommand.decode(G,G.uint32());break}default:G.skipType(D&7);break}}return Z},J.decodeDelimited=function Y(G){if(!(G instanceof V))G=new V(G);return this.decode(G,G.uint32())},J.verify=function Y(G){if(typeof G!=="object"||G===null)return"object expected";if(G.opCode!=null&&G.hasOwnProperty("opCode"))switch(G.opCode){default:return"opCode: enum value expected";case 0:case 1:break}if(G.init!=null&&G.hasOwnProperty("init")){let Q=q.dfu.InitCommand.verify(G.init);if(Q)return"init."+Q}if(G.reset!=null&&G.hasOwnProperty("reset")){let Q=q.dfu.ResetCommand.verify(G.reset);if(Q)return"reset."+Q}return null},J.fromObject=function Y(G){if(G instanceof q.dfu.Command)return G;let Q=new q.dfu.Command;switch(G.opCode){default:if(typeof G.opCode==="number"){Q.opCode=G.opCode;break}break;case"RESET":case 0:Q.opCode=0;break;case"INIT":case 1:Q.opCode=1;break}if(G.init!=null){if(typeof G.init!=="object")throw TypeError(".dfu.Command.init: object expected");Q.init=q.dfu.InitCommand.fromObject(G.init)}if(G.reset!=null){if(typeof G.reset!=="object")throw TypeError(".dfu.Command.reset: object expected");Q.reset=q.dfu.ResetCommand.fromObject(G.reset)}return Q},J.toObject=function Y(G,Q){if(!Q)Q={};let T={};if(Q.defaults)T.opCode=Q.enums===String?"RESET":0,T.init=null,T.reset=null;if(G.opCode!=null&&G.hasOwnProperty("opCode"))T.opCode=Q.enums===String?q.dfu.OpCode[G.opCode]===void 0?G.opCode:q.dfu.OpCode[G.opCode]:G.opCode;if(G.init!=null&&G.hasOwnProperty("init"))T.init=q.dfu.InitCommand.toObject(G.init,Q);if(G.reset!=null&&G.hasOwnProperty("reset"))T.reset=q.dfu.ResetCommand.toObject(G.reset,Q);return T},J.prototype.toJSON=function Y(){return this.constructor.toObject(this,O.util.toJSONOptions)},J.getTypeUrl=function Y(G){if(G===void 0)G="type.googleapis.com";return G+"/dfu.Command"},J}(),X.SignatureType=function(){const J={},Y=Object.create(J);return Y[J[0]="ECDSA_P256_SHA256"]=0,Y[J[1]="ED25519"]=1,Y}(),X.SignedCommand=function(){function J(Y){if(Y){for(let G=Object.keys(Y),Q=0;Q<G.length;++Q)if(Y[G[Q]]!=null)this[G[Q]]=Y[G[Q]]}}return J.prototype.command=null,J.prototype.signatureType=0,J.prototype.signature=K.newBuffer([]),J.create=function Y(G){return new J(G)},J.encode=function Y(G,Q){if(!Q)Q=w.create();return q.dfu.Command.encode(G.command,Q.uint32(10).fork()).ldelim(),Q.uint32(16).int32(G.signatureType),Q.uint32(26).bytes(G.signature),Q},J.encodeDelimited=function Y(G,Q){return this.encode(G,Q).ldelim()},J.decode=function Y(G,Q){if(!(G instanceof V))G=V.create(G);let T=Q===void 0?G.len:G.pos+Q,Z=new q.dfu.SignedCommand;while(G.pos<T){let D=G.uint32();switch(D>>>3){case 1:{Z.command=q.dfu.Command.decode(G,G.uint32());break}case 2:{Z.signatureType=G.int32();break}case 3:{Z.signature=G.bytes();break}default:G.skipType(D&7);break}}if(!Z.hasOwnProperty("command"))throw K.ProtocolError("missing required 'command'",{instance:Z});if(!Z.hasOwnProperty("signatureType"))throw K.ProtocolError("missing required 'signatureType'",{instance:Z});if(!Z.hasOwnProperty("signature"))throw K.ProtocolError("missing required 'signature'",{instance:Z});return Z},J.decodeDelimited=function Y(G){if(!(G instanceof V))G=new V(G);return this.decode(G,G.uint32())},J.verify=function Y(G){if(typeof G!=="object"||G===null)return"object expected";{let Q=q.dfu.Command.verify(G.command);if(Q)return"command."+Q}switch(G.signatureType){default:return"signatureType: enum value expected";case 0:case 1:break}if(!(G.signature&&typeof G.signature.length==="number"||K.isString(G.signature)))return"signature: buffer expected";return null},J.fromObject=function Y(G){if(G instanceof q.dfu.SignedCommand)return G;let Q=new q.dfu.SignedCommand;if(G.command!=null){if(typeof G.command!=="object")throw TypeError(".dfu.SignedCommand.command: object expected");Q.command=q.dfu.Command.fromObject(G.command)}switch(G.signatureType){default:if(typeof G.signatureType==="number"){Q.signatureType=G.signatureType;break}break;case"ECDSA_P256_SHA256":case 0:Q.signatureType=0;break;case"ED25519":case 1:Q.signatureType=1;break}if(G.signature!=null){if(typeof G.signature==="string")K.base64.decode(G.signature,Q.signature=K.newBuffer(K.base64.length(G.signature)),0);else if(G.signature.length>=0)Q.signature=G.signature}return Q},J.toObject=function Y(G,Q){if(!Q)Q={};let T={};if(Q.defaults){if(T.command=null,T.signatureType=Q.enums===String?"ECDSA_P256_SHA256":0,Q.bytes===String)T.signature="";else if(T.signature=[],Q.bytes!==Array)T.signature=K.newBuffer(T.signature)}if(G.command!=null&&G.hasOwnProperty("command"))T.command=q.dfu.Command.toObject(G.command,Q);if(G.signatureType!=null&&G.hasOwnProperty("signatureType"))T.signatureType=Q.enums===String?q.dfu.SignatureType[G.signatureType]===void 0?G.signatureType:q.dfu.SignatureType[G.signatureType]:G.signatureType;if(G.signature!=null&&G.hasOwnProperty("signature"))T.signature=Q.bytes===String?K.base64.encode(G.signature,0,G.signature.length):Q.bytes===Array?Array.prototype.slice.call(G.signature):G.signature;return T},J.prototype.toJSON=function Y(){return this.constructor.toObject(this,O.util.toJSONOptions)},J.getTypeUrl=function Y(G){if(G===void 0)G="type.googleapis.com";return G+"/dfu.SignedCommand"},J}(),X.Packet=function(){function J(Y){if(Y){for(let G=Object.keys(Y),Q=0;Q<G.length;++Q)if(Y[G[Q]]!=null)this[G[Q]]=Y[G[Q]]}}return J.prototype.command=null,J.prototype.signedCommand=null,J.create=function Y(G){return new J(G)},J.encode=function Y(G,Q){if(!Q)Q=w.create();if(G.command!=null&&Object.hasOwnProperty.call(G,"command"))q.dfu.Command.encode(G.command,Q.uint32(10).fork()).ldelim();if(G.signedCommand!=null&&Object.hasOwnProperty.call(G,"signedCommand"))q.dfu.SignedCommand.encode(G.signedCommand,Q.uint32(18).fork()).ldelim();return Q},J.encodeDelimited=function Y(G,Q){return this.encode(G,Q).ldelim()},J.decode=function Y(G,Q){if(!(G instanceof V))G=V.create(G);let T=Q===void 0?G.len:G.pos+Q,Z=new q.dfu.Packet;while(G.pos<T){let D=G.uint32();switch(D>>>3){case 1:{Z.command=q.dfu.Command.decode(G,G.uint32());break}case 2:{Z.signedCommand=q.dfu.SignedCommand.decode(G,G.uint32());break}default:G.skipType(D&7);break}}return Z},J.decodeDelimited=function Y(G){if(!(G instanceof V))G=new V(G);return this.decode(G,G.uint32())},J.verify=function Y(G){if(typeof G!=="object"||G===null)return"object expected";if(G.command!=null&&G.hasOwnProperty("command")){let Q=q.dfu.Command.verify(G.command);if(Q)return"command."+Q}if(G.signedCommand!=null&&G.hasOwnProperty("signedCommand")){let Q=q.dfu.SignedCommand.verify(G.signedCommand);if(Q)return"signedCommand."+Q}return null},J.fromObject=function Y(G){if(G instanceof q.dfu.Packet)return G;let Q=new q.dfu.Packet;if(G.command!=null){if(typeof G.command!=="object")throw TypeError(".dfu.Packet.command: object expected");Q.command=q.dfu.Command.fromObject(G.command)}if(G.signedCommand!=null){if(typeof G.signedCommand!=="object")throw TypeError(".dfu.Packet.signedCommand: object expected");Q.signedCommand=q.dfu.SignedCommand.fromObject(G.signedCommand)}return Q},J.toObject=function Y(G,Q){if(!Q)Q={};let T={};if(Q.defaults)T.command=null,T.signedCommand=null;if(G.command!=null&&G.hasOwnProperty("command"))T.command=q.dfu.Command.toObject(G.command,Q);if(G.signedCommand!=null&&G.hasOwnProperty("signedCommand"))T.signedCommand=q.dfu.SignedCommand.toObject(G.signedCommand,Q);return T},J.prototype.toJSON=function Y(){return this.constructor.toObject(this,O.util.toJSONOptions)},J.getTypeUrl=function Y(G){if(G===void 0)G="type.googleapis.com";return G+"/dfu.Packet"},J}(),X})();var g=function(X){if(X)throw Error(X)};function X0({firmwareHash:X,appSize:J,privateKey:Y,fwVersion:G=1,hwVersion:Q=52,sdReq:T=[259],isDebug:Z,verify:D=!1}){const N={type:z.FwType.APPLICATION,fwVersion:G,hwVersion:Q,sdReq:T,appSize:J,isDebug:Z,hash:{hashType:z.HashType.SHA256,hash:X},bootValidation:[{type:z.ValidationType.VALIDATE_GENERATED_CRC,bytes:h8.alloc(0)}]};if(D)g(z.InitCommand.verify(N));const M=z.InitCommand.create(N),H={opCode:z.OpCode.INIT,init:M};if(D)g(z.Command.verify(H));const I=z.Command.create(H),k=z.Command.encode(I).finish(),A8=K0(k,Y),T0={command:I,signatureType:z.SignatureType.ECDSA_P256_SHA256,signature:A8};if(D)g(z.SignedCommand.verify(T0));const Z0={signedCommand:z.SignedCommand.create(T0)};if(D)g(z.Packet.verify(Z0));const H8=z.Packet.create(Z0);return z.Packet.encode(H8).finish()}var $8=function(X,J,Y){const G=q8.from(J,"binary");if(G.byteLength!==Y.byteLength)throw new Error("Public key is not the same length as the pattern");const Q=X.indexOf(G);if(Q===-1)throw new Error("Pattern not found in firmware");const T=q8.from(X);return Y.copy(T,Q),T};function y8({firmware:X,privateKey:J,pattern:Y="OFFLINEFINDINGPUBLICKEYHERE!"}){const G=q0(),Q=A0(G),T=$8(X,Y,Q),Z=H0(T),D=X0({firmwareHash:Z,appSize:T.byteLength,privateKey:J,verify:!0});return{manifest:D0,initPacket:D,firmwarePatched:T,privateKeyForAccessory:G}}export{y8 as default};
