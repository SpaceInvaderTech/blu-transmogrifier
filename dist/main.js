var V8=Object.create;var{defineProperty:D0,getPrototypeOf:L8,getOwnPropertyNames:O8}=Object;var z8=Object.prototype.hasOwnProperty;var I8=(X,G,Y)=>{Y=X!=null?V8(L8(X)):{};const J=G||!X||!X.__esModule?D0(Y,"default",{value:X,enumerable:!0}):Y;for(let Q of O8(X))if(!z8.call(J,Q))D0(J,Q,{get:()=>X[Q],enumerable:!0});return J};var O=(X,G)=>()=>(G||X((G={exports:{}}).exports,G),G.exports);var O0=O((i8,L0)=>{var U8=function(X,G){var Y=new Array(arguments.length-1),J=0,Q=2,T=!0;while(Q<arguments.length)Y[J++]=arguments[Q++];return new Promise(function Z(N,M){Y[J]=function D(K){if(T)if(T=!1,K)M(K);else{var z=new Array(arguments.length-1),W=0;while(W<z.length)z[W++]=arguments[W];N.apply(null,z)}};try{X.apply(G||null,Y)}catch(D){if(T)T=!1,M(D)}})};L0.exports=U8});var W0=O((_0)=>{var l=_0;l.length=function X(G){var Y=G.length;if(!Y)return 0;var J=0;while(--Y%4>1&&G.charAt(Y)==="=")++J;return Math.ceil(G.length*3)/4-J};var c=new Array(64),I0=new Array(123);for(C=0;C<64;)I0[c[C]=C<26?C+65:C<52?C+71:C<62?C-4:C-59|43]=C++;var C;l.encode=function X(G,Y,J){var Q=null,T=[],Z=0,N=0,M;while(Y<J){var D=G[Y++];switch(N){case 0:T[Z++]=c[D>>2],M=(D&3)<<4,N=1;break;case 1:T[Z++]=c[M|D>>4],M=(D&15)<<2,N=2;break;case 2:T[Z++]=c[M|D>>6],T[Z++]=c[D&63],N=0;break}if(Z>8191)(Q||(Q=[])).push(String.fromCharCode.apply(String,T)),Z=0}if(N){if(T[Z++]=c[M],T[Z++]=61,N===1)T[Z++]=61}if(Q){if(Z)Q.push(String.fromCharCode.apply(String,T.slice(0,Z)));return Q.join("")}return String.fromCharCode.apply(String,T.slice(0,Z))};var z0="invalid encoding";l.decode=function X(G,Y,J){var Q=J,T=0,Z;for(var N=0;N<G.length;){var M=G.charCodeAt(N++);if(M===61&&T>1)break;if((M=I0[M])===void 0)throw Error(z0);switch(T){case 0:Z=M,T=1;break;case 1:Y[J++]=Z<<2|(M&48)>>4,Z=M,T=2;break;case 2:Y[J++]=(Z&15)<<4|(M&60)>>2,Z=M,T=3;break;case 3:Y[J++]=(Z&3)<<6|M,T=0;break}}if(T===1)throw Error(z0);return J-Q};l.test=function X(G){return/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/.test(G)}});var C0=O((t8,P0)=>{var u=function(){this._listeners={}};P0.exports=u;u.prototype.on=function X(G,Y,J){return(this._listeners[G]||(this._listeners[G]=[])).push({fn:Y,ctx:J||this}),this};u.prototype.off=function X(G,Y){if(G===void 0)this._listeners={};else if(Y===void 0)this._listeners[G]=[];else{var J=this._listeners[G];for(var Q=0;Q<J.length;)if(J[Q].fn===Y)J.splice(Q,1);else++Q}return this};u.prototype.emit=function X(G){var Y=this._listeners[G];if(Y){var J=[],Q=1;for(;Q<arguments.length;)J.push(arguments[Q++]);for(Q=0;Q<Y.length;)Y[Q].fn.apply(Y[Q++].ctx,J)}return this}});var $0=O((a8,h0)=>{var U0=function(X){if(typeof Float32Array!=="undefined")(function(){var G=new Float32Array([-0]),Y=new Uint8Array(G.buffer),J=Y[3]===128;function Q(M,D,K){G[0]=M,D[K]=Y[0],D[K+1]=Y[1],D[K+2]=Y[2],D[K+3]=Y[3]}function T(M,D,K){G[0]=M,D[K]=Y[3],D[K+1]=Y[2],D[K+2]=Y[1],D[K+3]=Y[0]}X.writeFloatLE=J?Q:T,X.writeFloatBE=J?T:Q;function Z(M,D){return Y[0]=M[D],Y[1]=M[D+1],Y[2]=M[D+2],Y[3]=M[D+3],G[0]}function N(M,D){return Y[3]=M[D],Y[2]=M[D+1],Y[1]=M[D+2],Y[0]=M[D+3],G[0]}X.readFloatLE=J?Z:N,X.readFloatBE=J?N:Z})();else(function(){function G(J,Q,T,Z){var N=Q<0?1:0;if(N)Q=-Q;if(Q===0)J(1/Q>0?0:2147483648,T,Z);else if(isNaN(Q))J(2143289344,T,Z);else if(Q>340282346638528860000000000000000000000)J((N<<31|2139095040)>>>0,T,Z);else if(Q<0.000000000000000000000000000000000000011754943508222875)J((N<<31|Math.round(Q/0.000000000000000000000000000000000000000000001401298464324817))>>>0,T,Z);else{var M=Math.floor(Math.log(Q)/Math.LN2),D=Math.round(Q*Math.pow(2,-M)*8388608)&8388607;J((N<<31|M+127<<23|D)>>>0,T,Z)}}X.writeFloatLE=G.bind(null,R0),X.writeFloatBE=G.bind(null,k0);function Y(J,Q,T){var Z=J(Q,T),N=(Z>>31)*2+1,M=Z>>>23&255,D=Z&8388607;return M===255?D?NaN:N*Infinity:M===0?N*0.000000000000000000000000000000000000000000001401298464324817*D:N*Math.pow(2,M-150)*(D+8388608)}X.readFloatLE=Y.bind(null,B0),X.readFloatBE=Y.bind(null,x0)})();if(typeof Float64Array!=="undefined")(function(){var G=new Float64Array([-0]),Y=new Uint8Array(G.buffer),J=Y[7]===128;function Q(M,D,K){G[0]=M,D[K]=Y[0],D[K+1]=Y[1],D[K+2]=Y[2],D[K+3]=Y[3],D[K+4]=Y[4],D[K+5]=Y[5],D[K+6]=Y[6],D[K+7]=Y[7]}function T(M,D,K){G[0]=M,D[K]=Y[7],D[K+1]=Y[6],D[K+2]=Y[5],D[K+3]=Y[4],D[K+4]=Y[3],D[K+5]=Y[2],D[K+6]=Y[1],D[K+7]=Y[0]}X.writeDoubleLE=J?Q:T,X.writeDoubleBE=J?T:Q;function Z(M,D){return Y[0]=M[D],Y[1]=M[D+1],Y[2]=M[D+2],Y[3]=M[D+3],Y[4]=M[D+4],Y[5]=M[D+5],Y[6]=M[D+6],Y[7]=M[D+7],G[0]}function N(M,D){return Y[7]=M[D],Y[6]=M[D+1],Y[5]=M[D+2],Y[4]=M[D+3],Y[3]=M[D+4],Y[2]=M[D+5],Y[1]=M[D+6],Y[0]=M[D+7],G[0]}X.readDoubleLE=J?Z:N,X.readDoubleBE=J?N:Z})();else(function(){function G(J,Q,T,Z,N,M){var D=Z<0?1:0;if(D)Z=-Z;if(Z===0)J(0,N,M+Q),J(1/Z>0?0:2147483648,N,M+T);else if(isNaN(Z))J(0,N,M+Q),J(2146959360,N,M+T);else if(Z>179769313486231570000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000)J(0,N,M+Q),J((D<<31|2146435072)>>>0,N,M+T);else{var K;if(Z<0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000022250738585072014)K=Z/0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005,J(K>>>0,N,M+Q),J((D<<31|K/4294967296)>>>0,N,M+T);else{var z=Math.floor(Math.log(Z)/Math.LN2);if(z===1024)z=1023;K=Z*Math.pow(2,-z),J(K*4503599627370496>>>0,N,M+Q),J((D<<31|z+1023<<20|K*1048576&1048575)>>>0,N,M+T)}}}X.writeDoubleLE=G.bind(null,R0,0,4),X.writeDoubleBE=G.bind(null,k0,4,0);function Y(J,Q,T,Z,N){var M=J(Z,N+Q),D=J(Z,N+T),K=(D>>31)*2+1,z=D>>>20&2047,W=4294967296*(D&1048575)+M;return z===2047?W?NaN:K*Infinity:z===0?K*0.000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000005*W:K*Math.pow(2,z-1075)*(W+4503599627370496)}X.readDoubleLE=Y.bind(null,B0,0,4),X.readDoubleBE=Y.bind(null,x0,4,0)})();return X},R0=function(X,G,Y){G[Y]=X&255,G[Y+1]=X>>>8&255,G[Y+2]=X>>>16&255,G[Y+3]=X>>>24},k0=function(X,G,Y){G[Y]=X>>>24,G[Y+1]=X>>>16&255,G[Y+2]=X>>>8&255,G[Y+3]=X&255},B0=function(X,G){return(X[G]|X[G+1]<<8|X[G+2]<<16|X[G+3]<<24)>>>0},x0=function(X,G){return(X[G]<<24|X[G+1]<<16|X[G+2]<<8|X[G+3])>>>0};h0.exports=U0(U0)});var w0=O((r8,y0)=>{var R8=function(X){try{var G=(0, eval)("quire".replace(/^/,"re"))(X);if(G&&(G.length||Object.keys(G).length))return G}catch(Y){}return null};y0.exports=R8});var c0=O((j0)=>{var m=j0;m.length=function X(G){var Y=0,J=0;for(var Q=0;Q<G.length;++Q)if(J=G.charCodeAt(Q),J<128)Y+=1;else if(J<2048)Y+=2;else if((J&64512)===55296&&(G.charCodeAt(Q+1)&64512)===56320)++Q,Y+=4;else Y+=3;return Y};m.read=function X(G,Y,J){var Q=J-Y;if(Q<1)return"";var T=null,Z=[],N=0,M;while(Y<J){if(M=G[Y++],M<128)Z[N++]=M;else if(M>191&&M<224)Z[N++]=(M&31)<<6|G[Y++]&63;else if(M>239&&M<365)M=((M&7)<<18|(G[Y++]&63)<<12|(G[Y++]&63)<<6|G[Y++]&63)-65536,Z[N++]=55296+(M>>10),Z[N++]=56320+(M&1023);else Z[N++]=(M&15)<<12|(G[Y++]&63)<<6|G[Y++]&63;if(N>8191)(T||(T=[])).push(String.fromCharCode.apply(String,Z)),N=0}if(T){if(N)T.push(String.fromCharCode.apply(String,Z.slice(0,N)));return T.join("")}return String.fromCharCode.apply(String,Z.slice(0,N))};m.write=function X(G,Y,J){var Q=J,T,Z;for(var N=0;N<G.length;++N)if(T=G.charCodeAt(N),T<128)Y[J++]=T;else if(T<2048)Y[J++]=T>>6|192,Y[J++]=T&63|128;else if((T&64512)===55296&&((Z=G.charCodeAt(N+1))&64512)===56320)T=65536+((T&1023)<<10)+(Z&1023),++N,Y[J++]=T>>18|240,Y[J++]=T>>12&63|128,Y[J++]=T>>6&63|128,Y[J++]=T&63|128;else Y[J++]=T>>12|224,Y[J++]=T>>6&63|128,Y[J++]=T&63|128;return J-Q}});var n0=O((e8,v0)=>{var k8=function(X,G,Y){var J=Y||8192,Q=J>>>1,T=null,Z=J;return function N(M){if(M<1||M>Q)return X(M);if(Z+M>J)T=X(J),Z=0;var D=G.call(T,Z,Z+=M);if(Z&7)Z=(Z|7)+1;return D}};v0.exports=k8});var b0=O((JJ,d0)=>{var L=function(X,G){this.lo=X>>>0,this.hi=G>>>0};d0.exports=L;var v=x(),$=L.zero=new L(0,0);$.toNumber=function(){return 0};$.zzEncode=$.zzDecode=function(){return this};$.length=function(){return 1};var B8=L.zeroHash="\0\0\0\0\0\0\0\0";L.fromNumber=function X(G){if(G===0)return $;var Y=G<0;if(Y)G=-G;var J=G>>>0,Q=(G-J)/4294967296>>>0;if(Y){if(Q=~Q>>>0,J=~J>>>0,++J>4294967295){if(J=0,++Q>4294967295)Q=0}}return new L(J,Q)};L.from=function X(G){if(typeof G==="number")return L.fromNumber(G);if(v.isString(G))if(v.Long)G=v.Long.fromString(G);else return L.fromNumber(parseInt(G,10));return G.low||G.high?new L(G.low>>>0,G.high>>>0):$};L.prototype.toNumber=function X(G){if(!G&&this.hi>>>31){var Y=~this.lo+1>>>0,J=~this.hi>>>0;if(!Y)J=J+1>>>0;return-(Y+J*4294967296)}return this.lo+this.hi*4294967296};L.prototype.toLong=function X(G){return v.Long?new v.Long(this.lo|0,this.hi|0,Boolean(G)):{low:this.lo|0,high:this.hi|0,unsigned:Boolean(G)}};var B=String.prototype.charCodeAt;L.fromHash=function X(G){if(G===B8)return $;return new L((B.call(G,0)|B.call(G,1)<<8|B.call(G,2)<<16|B.call(G,3)<<24)>>>0,(B.call(G,4)|B.call(G,5)<<8|B.call(G,6)<<16|B.call(G,7)<<24)>>>0)};L.prototype.toHash=function X(){return String.fromCharCode(this.lo&255,this.lo>>>8&255,this.lo>>>16&255,this.lo>>>24,this.hi&255,this.hi>>>8&255,this.hi>>>16&255,this.hi>>>24)};L.prototype.zzEncode=function X(){var G=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^G)>>>0,this.lo=(this.lo<<1^G)>>>0,this};L.prototype.zzDecode=function X(){var G=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^G)>>>0,this.hi=(this.hi>>>1^G)>>>0,this};L.prototype.length=function X(){var G=this.lo,Y=(this.lo>>>28|this.hi<<4)>>>0,J=this.hi>>>24;return J===0?Y===0?G<16384?G<128?1:2:G<2097152?3:4:Y<16384?Y<128?5:6:Y<2097152?7:8:J<128?9:10}});var x=O((i)=>{var p0=function(X,G,Y){for(var J=Object.keys(G),Q=0;Q<J.length;++Q)if(X[J[Q]]===void 0||!Y)X[J[Q]]=G[J[Q]];return X},l0=function(X){function G(Y,J){if(!(this instanceof G))return new G(Y,J);if(Object.defineProperty(this,"message",{get:function(){return Y}}),Error.captureStackTrace)Error.captureStackTrace(this,G);else Object.defineProperty(this,"stack",{value:new Error().stack||""});if(J)p0(this,J)}return G.prototype=Object.create(Error.prototype,{constructor:{value:G,writable:!0,enumerable:!1,configurable:!0},name:{get:function Y(){return X},set:void 0,enumerable:!1,configurable:!0},toString:{value:function Y(){return this.name+": "+this.message},writable:!0,enumerable:!1,configurable:!0}}),G},A=i;A.asPromise=O0();A.base64=W0();A.EventEmitter=C0();A.float=$0();A.inquire=w0();A.utf8=c0();A.pool=n0();A.LongBits=b0();A.isNode=Boolean(typeof global!=="undefined"&&global&&global.process&&global.process.versions&&global.process.versions.node);A.global=A.isNode&&global||typeof window!=="undefined"&&window||typeof self!=="undefined"&&self||i;A.emptyArray=Object.freeze?Object.freeze([]):[];A.emptyObject=Object.freeze?Object.freeze({}):{};A.isInteger=Number.isInteger||function X(G){return typeof G==="number"&&isFinite(G)&&Math.floor(G)===G};A.isString=function X(G){return typeof G==="string"||G instanceof String};A.isObject=function X(G){return G&&typeof G==="object"};A.isset=A.isSet=function X(G,Y){var J=G[Y];if(J!=null&&G.hasOwnProperty(Y))return typeof J!=="object"||(Array.isArray(J)?J.length:Object.keys(J).length)>0;return!1};A.Buffer=function(){try{var X=A.inquire("buffer").Buffer;return X.prototype.utf8Write?X:null}catch(G){return null}}();A._Buffer_from=null;A._Buffer_allocUnsafe=null;A.newBuffer=function X(G){return typeof G==="number"?A.Buffer?A._Buffer_allocUnsafe(G):new A.Array(G):A.Buffer?A._Buffer_from(G):typeof Uint8Array==="undefined"?G:new Uint8Array(G)};A.Array=typeof Uint8Array!=="undefined"?Uint8Array:Array;A.Long=A.global.dcodeIO&&A.global.dcodeIO.Long||A.global.Long||A.inquire("long");A.key2Re=/^true|false|0|1$/;A.key32Re=/^-?(?:0|[1-9][0-9]*)$/;A.key64Re=/^(?:[\\x00-\\xff]{8}|-?(?:0|[1-9][0-9]*))$/;A.longToHash=function X(G){return G?A.LongBits.from(G).toHash():A.LongBits.zeroHash};A.longFromHash=function X(G,Y){var J=A.LongBits.fromHash(G);if(A.Long)return A.Long.fromBits(J.lo,J.hi,Y);return J.toNumber(Boolean(Y))};A.merge=p0;A.lcFirst=function X(G){return G.charAt(0).toLowerCase()+G.substring(1)};A.newError=l0;A.ProtocolError=l0("ProtocolError");A.oneOfGetter=function X(G){var Y={};for(var J=0;J<G.length;++J)Y[G[J]]=1;return function(){for(var Q=Object.keys(this),T=Q.length-1;T>-1;--T)if(Y[Q[T]]===1&&this[Q[T]]!==void 0&&this[Q[T]]!==null)return Q[T]}};A.oneOfSetter=function X(G){return function(Y){for(var J=0;J<G.length;++J)if(G[J]!==Y)delete this[G[J]]}};A.toJSONOptions={longs:String,enums:String,bytes:String,json:!0};A._configure=function(){var X=A.Buffer;if(!X){A._Buffer_from=A._Buffer_allocUnsafe=null;return}A._Buffer_from=X.from!==Uint8Array.from&&X.from||function G(Y,J){return new X(Y,J)},A._Buffer_allocUnsafe=X.allocUnsafe||function G(Y){return new X(Y)}}});var J0=O((QJ,m0)=>{var n=function(X,G,Y){this.fn=X,this.len=G,this.next=void 0,this.val=Y},a=function(){},x8=function(X){this.head=X.head,this.tail=X.tail,this.len=X.len,this.next=X.states},S=function(){this.len=0,this.head=new n(a,0,0),this.tail=this.head,this.states=null},r=function(X,G,Y){G[Y]=X&255},h8=function(X,G,Y){while(X>127)G[Y++]=X&127|128,X>>>=7;G[Y]=X},s=function(X,G){this.len=X,this.next=void 0,this.val=G},e=function(X,G,Y){while(X.hi)G[Y++]=X.lo&127|128,X.lo=(X.lo>>>7|X.hi<<25)>>>0,X.hi>>>=7;while(X.lo>127)G[Y++]=X.lo&127|128,X.lo=X.lo>>>7;G[Y++]=X.lo},t=function(X,G,Y){G[Y]=X&255,G[Y+1]=X>>>8&255,G[Y+2]=X>>>16&255,G[Y+3]=X>>>24};m0.exports=S;var P=x(),o,g=P.LongBits,u0=P.base64,g0=P.utf8,f0=function X(){return P.Buffer?function G(){return(S.create=function Y(){return new o})()}:function G(){return new S}};S.create=f0();S.alloc=function X(G){return new P.Array(G)};if(P.Array!==Array)S.alloc=P.pool(S.alloc,P.Array.prototype.subarray);S.prototype._push=function X(G,Y,J){return this.tail=this.tail.next=new n(G,Y,J),this.len+=Y,this};s.prototype=Object.create(n.prototype);s.prototype.fn=h8;S.prototype.uint32=function X(G){return this.len+=(this.tail=this.tail.next=new s((G=G>>>0)<128?1:G<16384?2:G<2097152?3:G<268435456?4:5,G)).len,this};S.prototype.int32=function X(G){return G<0?this._push(e,10,g.fromNumber(G)):this.uint32(G)};S.prototype.sint32=function X(G){return this.uint32((G<<1^G>>31)>>>0)};S.prototype.uint64=function X(G){var Y=g.from(G);return this._push(e,Y.length(),Y)};S.prototype.int64=S.prototype.uint64;S.prototype.sint64=function X(G){var Y=g.from(G).zzEncode();return this._push(e,Y.length(),Y)};S.prototype.bool=function X(G){return this._push(r,1,G?1:0)};S.prototype.fixed32=function X(G){return this._push(t,4,G>>>0)};S.prototype.sfixed32=S.prototype.fixed32;S.prototype.fixed64=function X(G){var Y=g.from(G);return this._push(t,4,Y.lo)._push(t,4,Y.hi)};S.prototype.sfixed64=S.prototype.fixed64;S.prototype.float=function X(G){return this._push(P.float.writeFloatLE,4,G)};S.prototype.double=function X(G){return this._push(P.float.writeDoubleLE,8,G)};var $8=P.Array.prototype.set?function X(G,Y,J){Y.set(G,J)}:function X(G,Y,J){for(var Q=0;Q<G.length;++Q)Y[J+Q]=G[Q]};S.prototype.bytes=function X(G){var Y=G.length>>>0;if(!Y)return this._push(r,1,0);if(P.isString(G)){var J=S.alloc(Y=u0.length(G));u0.decode(G,J,0),G=J}return this.uint32(Y)._push($8,Y,G)};S.prototype.string=function X(G){var Y=g0.length(G);return Y?this.uint32(Y)._push(g0.write,Y,G):this._push(r,1,0)};S.prototype.fork=function X(){return this.states=new x8(this),this.head=this.tail=new n(a,0,0),this.len=0,this};S.prototype.reset=function X(){if(this.states)this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next;else this.head=this.tail=new n(a,0,0),this.len=0;return this};S.prototype.ldelim=function X(){var G=this.head,Y=this.tail,J=this.len;if(this.reset().uint32(J),J)this.tail.next=G.next,this.tail=Y,this.len+=J;return this};S.prototype.finish=function X(){var G=this.head.next,Y=this.constructor.alloc(this.len),J=0;while(G)G.fn(G.val,Y,J),J+=G.len,G=G.next;return Y};S._configure=function(X){o=X,S.create=f0(),o._configure()}});var t0=O((YJ,o0)=>{var k=function(){i0.call(this)},y8=function(X,G,Y){if(X.length<40)h.utf8.write(X,G,Y);else if(G.utf8Write)G.utf8Write(X,Y);else G.write(X,Y)};o0.exports=k;var i0=J0();(k.prototype=Object.create(i0.prototype)).constructor=k;var h=x();k._configure=function(){k.alloc=h._Buffer_allocUnsafe,k.writeBytesBuffer=h.Buffer&&h.Buffer.prototype instanceof Uint8Array&&h.Buffer.prototype.set.name==="set"?function X(G,Y,J){Y.set(G,J)}:function X(G,Y,J){if(G.copy)G.copy(Y,J,0,G.length);else for(var Q=0;Q<G.length;)Y[J++]=G[Q++]}};k.prototype.bytes=function X(G){if(h.isString(G))G=h._Buffer_from(G,"base64");var Y=G.length>>>0;if(this.uint32(Y),Y)this._push(k.writeBytesBuffer,Y,G);return this};k.prototype.string=function X(G){var Y=h.Buffer.byteLength(G);if(this.uint32(Y),Y)this._push(y8,Y,G);return this};k._configure()});var Y0=O((XJ,J8)=>{var R=function(X,G){return RangeError("index out of range: "+X.pos+" + "+(G||1)+" > "+X.len)},E=function(X){this.buf=X,this.pos=0,this.len=X.length},G0=function(){var X=new s0(0,0),G=0;if(this.len-this.pos>4){for(;G<4;++G)if(X.lo=(X.lo|(this.buf[this.pos]&127)<<G*7)>>>0,this.buf[this.pos++]<128)return X;if(X.lo=(X.lo|(this.buf[this.pos]&127)<<28)>>>0,X.hi=(X.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return X;G=0}else{for(;G<3;++G){if(this.pos>=this.len)throw R(this);if(X.lo=(X.lo|(this.buf[this.pos]&127)<<G*7)>>>0,this.buf[this.pos++]<128)return X}return X.lo=(X.lo|(this.buf[this.pos++]&127)<<G*7)>>>0,X}if(this.len-this.pos>4){for(;G<5;++G)if(X.hi=(X.hi|(this.buf[this.pos]&127)<<G*7+3)>>>0,this.buf[this.pos++]<128)return X}else for(;G<5;++G){if(this.pos>=this.len)throw R(this);if(X.hi=(X.hi|(this.buf[this.pos]&127)<<G*7+3)>>>0,this.buf[this.pos++]<128)return X}throw Error("invalid varint encoding")},f=function(X,G){return(X[G-4]|X[G-3]<<8|X[G-2]<<16|X[G-1]<<24)>>>0},r0=function(){if(this.pos+8>this.len)throw R(this,8);return new s0(f(this.buf,this.pos+=4),f(this.buf,this.pos+=4))};J8.exports=E;var U=x(),Q0,s0=U.LongBits,w8=U.utf8,a0=typeof Uint8Array!=="undefined"?function X(G){if(G instanceof Uint8Array||Array.isArray(G))return new E(G);throw Error("illegal buffer")}:function X(G){if(Array.isArray(G))return new E(G);throw Error("illegal buffer")},e0=function X(){return U.Buffer?function G(Y){return(E.create=function J(Q){return U.Buffer.isBuffer(Q)?new Q0(Q):a0(Q)})(Y)}:a0};E.create=e0();E.prototype._slice=U.Array.prototype.subarray||U.Array.prototype.slice;E.prototype.uint32=function X(){var G=4294967295;return function Y(){if(G=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128)return G;if(G=(G|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)return G;if(G=(G|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)return G;if(G=(G|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)return G;if(G=(G|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128)return G;if((this.pos+=5)>this.len)throw this.pos=this.len,R(this,10);return G}}();E.prototype.int32=function X(){return this.uint32()|0};E.prototype.sint32=function X(){var G=this.uint32();return G>>>1^-(G&1)|0};E.prototype.bool=function X(){return this.uint32()!==0};E.prototype.fixed32=function X(){if(this.pos+4>this.len)throw R(this,4);return f(this.buf,this.pos+=4)};E.prototype.sfixed32=function X(){if(this.pos+4>this.len)throw R(this,4);return f(this.buf,this.pos+=4)|0};E.prototype.float=function X(){if(this.pos+4>this.len)throw R(this,4);var G=U.float.readFloatLE(this.buf,this.pos);return this.pos+=4,G};E.prototype.double=function X(){if(this.pos+8>this.len)throw R(this,4);var G=U.float.readDoubleLE(this.buf,this.pos);return this.pos+=8,G};E.prototype.bytes=function X(){var G=this.uint32(),Y=this.pos,J=this.pos+G;if(J>this.len)throw R(this,G);if(this.pos+=G,Array.isArray(this.buf))return this.buf.slice(Y,J);if(Y===J){var Q=U.Buffer;return Q?Q.alloc(0):new this.buf.constructor(0)}return this._slice.call(this.buf,Y,J)};E.prototype.string=function X(){var G=this.bytes();return w8.read(G,0,G.length)};E.prototype.skip=function X(G){if(typeof G==="number"){if(this.pos+G>this.len)throw R(this,G);this.pos+=G}else do if(this.pos>=this.len)throw R(this);while(this.buf[this.pos++]&128);return this};E.prototype.skipType=function(X){switch(X){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:while((X=this.uint32()&7)!==4)this.skipType(X);break;case 5:this.skip(4);break;default:throw Error("invalid wire type "+X+" at offset "+this.pos)}return this};E._configure=function(X){Q0=X,E.create=e0(),Q0._configure();var G=U.Long?"toLong":"toNumber";U.merge(E.prototype,{int64:function Y(){return G0.call(this)[G](!1)},uint64:function Y(){return G0.call(this)[G](!0)},sint64:function Y(){return G0.call(this).zzDecode()[G](!1)},fixed64:function Y(){return r0.call(this)[G](!0)},sfixed64:function Y(){return r0.call(this)[G](!1)}})}});var X8=O((TJ,Y8)=>{var y=function(X){Q8.call(this,X)};Y8.exports=y;var Q8=Y0();(y.prototype=Object.create(Q8.prototype)).constructor=y;var G8=x();y._configure=function(){if(G8.Buffer)y.prototype._slice=G8.Buffer.prototype.slice};y.prototype.string=function X(){var G=this.uint32();return this.buf.utf8Slice?this.buf.utf8Slice(this.pos,this.pos=Math.min(this.pos+G,this.len)):this.buf.toString("utf-8",this.pos,this.pos=Math.min(this.pos+G,this.len))};y._configure()});var Z8=O((ZJ,T8)=>{var d=function(X,G,Y){if(typeof X!=="function")throw TypeError("rpcImpl must be a function");X0.EventEmitter.call(this),this.rpcImpl=X,this.requestDelimited=Boolean(G),this.responseDelimited=Boolean(Y)};T8.exports=d;var X0=x();(d.prototype=Object.create(X0.EventEmitter.prototype)).constructor=d;d.prototype.rpcCall=function X(G,Y,J,Q,T){if(!Q)throw TypeError("request must be specified");var Z=this;if(!T)return X0.asPromise(X,Z,G,Y,J,Q);if(!Z.rpcImpl){setTimeout(function(){T(Error("already ended"))},0);return}try{return Z.rpcImpl(G,Y[Z.requestDelimited?"encodeDelimited":"encode"](Q).finish(),function N(M,D){if(M)return Z.emit("error",M,G),T(M);if(D===null){Z.end(!0);return}if(!(D instanceof J))try{D=J[Z.responseDelimited?"decodeDelimited":"decode"](D)}catch(K){return Z.emit("error",K,G),T(K)}return Z.emit("data",D,G),T(null,D)})}catch(N){Z.emit("error",N,G),setTimeout(function(){T(N)},0);return}};d.prototype.end=function X(G){if(this.rpcImpl){if(!G)this.rpcImpl(null,null,null);this.rpcImpl=null,this.emit("end").off()}return this}});var N8=O((M8)=>{var j8=M8;j8.Service=Z8()});var q8=O((NJ,D8)=>{D8.exports={}});var H8=O((K8)=>{var A8=function(){_.util._configure(),_.Writer._configure(_.BufferWriter),_.Reader._configure(_.BufferReader)},_=K8;_.build="minimal";_.Writer=J0();_.BufferWriter=t0();_.Reader=Y0();_.BufferReader=X8();_.util=x();_.rpc=N8();_.roots=q8();_.configure=A8;A8()});import{Buffer as p} from"node:buffer";import{createECDH as q0,createHash as _8,sign as W8} from"node:crypto";function K0(){const X=q0(A0);return X.generateKeys(),X.getPrivateKey()}function H0(X){const G=q0(A0);G.setPrivateKey(X);const Y=G.getPublicKey(null,"compressed");return p.from(Y.subarray(1))}function S0(X){return _8("sha256").update(X).digest().reverse()}function C8(X){return p.concat([p.from(X.subarray(0,32)).reverse(),p.from(X.subarray(32,64)).reverse()])}function F0(X,G){return C8(W8("sha256",X,{key:G,dsaEncoding:P8}))}var A0="secp224r1",P8="ieee-p1363";import{Buffer as E0} from"node:buffer";function V0(X,G,Y="OFFLINEFINDINGPUBLICKEYHERE!"){const J=E0.from(Y,"binary");if(J.byteLength!==G.byteLength)throw new Error("Public key is not the same length as the pattern");const Q=X.indexOf(J);if(Q===-1)throw new Error("Pattern not found in firmware");const T=E0.from(X);return G.copy(T,Q),T}import{Buffer as c8} from"node:buffer";var I=I8(H8(),1),F=I.Reader,w=I.Writer,H=I.util,q=I.roots.default||(I.roots.default={}),V=q.dfu=(()=>{const X={};return X.OpCode=function(){const G={},Y=Object.create(G);return Y[G[0]="RESET"]=0,Y[G[1]="INIT"]=1,Y}(),X.FwType=function(){const G={},Y=Object.create(G);return Y[G[0]="APPLICATION"]=0,Y[G[1]="SOFTDEVICE"]=1,Y[G[2]="BOOTLOADER"]=2,Y[G[3]="SOFTDEVICE_BOOTLOADER"]=3,Y[G[4]="EXTERNAL_APPLICATION"]=4,Y}(),X.HashType=function(){const G={},Y=Object.create(G);return Y[G[0]="NO_HASH"]=0,Y[G[1]="CRC"]=1,Y[G[2]="SHA128"]=2,Y[G[3]="SHA256"]=3,Y[G[4]="SHA512"]=4,Y}(),X.ValidationType=function(){const G={},Y=Object.create(G);return Y[G[0]="NO_VALIDATION"]=0,Y[G[1]="VALIDATE_GENERATED_CRC"]=1,Y[G[2]="VALIDATE_SHA256"]=2,Y[G[3]="VALIDATE_ECDSA_P256_SHA256"]=3,Y}(),X.Hash=function(){function G(Y){if(Y){for(let J=Object.keys(Y),Q=0;Q<J.length;++Q)if(Y[J[Q]]!=null)this[J[Q]]=Y[J[Q]]}}return G.prototype.hashType=0,G.prototype.hash=H.newBuffer([]),G.create=function Y(J){return new G(J)},G.encode=function Y(J,Q){if(!Q)Q=w.create();return Q.uint32(8).int32(J.hashType),Q.uint32(18).bytes(J.hash),Q},G.encodeDelimited=function Y(J,Q){return this.encode(J,Q).ldelim()},G.decode=function Y(J,Q){if(!(J instanceof F))J=F.create(J);let T=Q===void 0?J.len:J.pos+Q,Z=new q.dfu.Hash;while(J.pos<T){let N=J.uint32();switch(N>>>3){case 1:{Z.hashType=J.int32();break}case 2:{Z.hash=J.bytes();break}default:J.skipType(N&7);break}}if(!Z.hasOwnProperty("hashType"))throw H.ProtocolError("missing required 'hashType'",{instance:Z});if(!Z.hasOwnProperty("hash"))throw H.ProtocolError("missing required 'hash'",{instance:Z});return Z},G.decodeDelimited=function Y(J){if(!(J instanceof F))J=new F(J);return this.decode(J,J.uint32())},G.verify=function Y(J){if(typeof J!=="object"||J===null)return"object expected";switch(J.hashType){default:return"hashType: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(!(J.hash&&typeof J.hash.length==="number"||H.isString(J.hash)))return"hash: buffer expected";return null},G.fromObject=function Y(J){if(J instanceof q.dfu.Hash)return J;let Q=new q.dfu.Hash;switch(J.hashType){default:if(typeof J.hashType==="number"){Q.hashType=J.hashType;break}break;case"NO_HASH":case 0:Q.hashType=0;break;case"CRC":case 1:Q.hashType=1;break;case"SHA128":case 2:Q.hashType=2;break;case"SHA256":case 3:Q.hashType=3;break;case"SHA512":case 4:Q.hashType=4;break}if(J.hash!=null){if(typeof J.hash==="string")H.base64.decode(J.hash,Q.hash=H.newBuffer(H.base64.length(J.hash)),0);else if(J.hash.length>=0)Q.hash=J.hash}return Q},G.toObject=function Y(J,Q){if(!Q)Q={};let T={};if(Q.defaults){if(T.hashType=Q.enums===String?"NO_HASH":0,Q.bytes===String)T.hash="";else if(T.hash=[],Q.bytes!==Array)T.hash=H.newBuffer(T.hash)}if(J.hashType!=null&&J.hasOwnProperty("hashType"))T.hashType=Q.enums===String?q.dfu.HashType[J.hashType]===void 0?J.hashType:q.dfu.HashType[J.hashType]:J.hashType;if(J.hash!=null&&J.hasOwnProperty("hash"))T.hash=Q.bytes===String?H.base64.encode(J.hash,0,J.hash.length):Q.bytes===Array?Array.prototype.slice.call(J.hash):J.hash;return T},G.prototype.toJSON=function Y(){return this.constructor.toObject(this,I.util.toJSONOptions)},G.getTypeUrl=function Y(J){if(J===void 0)J="type.googleapis.com";return J+"/dfu.Hash"},G}(),X.BootValidation=function(){function G(Y){if(Y){for(let J=Object.keys(Y),Q=0;Q<J.length;++Q)if(Y[J[Q]]!=null)this[J[Q]]=Y[J[Q]]}}return G.prototype.type=0,G.prototype.bytes=H.newBuffer([]),G.create=function Y(J){return new G(J)},G.encode=function Y(J,Q){if(!Q)Q=w.create();return Q.uint32(8).int32(J.type),Q.uint32(18).bytes(J.bytes),Q},G.encodeDelimited=function Y(J,Q){return this.encode(J,Q).ldelim()},G.decode=function Y(J,Q){if(!(J instanceof F))J=F.create(J);let T=Q===void 0?J.len:J.pos+Q,Z=new q.dfu.BootValidation;while(J.pos<T){let N=J.uint32();switch(N>>>3){case 1:{Z.type=J.int32();break}case 2:{Z.bytes=J.bytes();break}default:J.skipType(N&7);break}}if(!Z.hasOwnProperty("type"))throw H.ProtocolError("missing required 'type'",{instance:Z});if(!Z.hasOwnProperty("bytes"))throw H.ProtocolError("missing required 'bytes'",{instance:Z});return Z},G.decodeDelimited=function Y(J){if(!(J instanceof F))J=new F(J);return this.decode(J,J.uint32())},G.verify=function Y(J){if(typeof J!=="object"||J===null)return"object expected";switch(J.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:break}if(!(J.bytes&&typeof J.bytes.length==="number"||H.isString(J.bytes)))return"bytes: buffer expected";return null},G.fromObject=function Y(J){if(J instanceof q.dfu.BootValidation)return J;let Q=new q.dfu.BootValidation;switch(J.type){default:if(typeof J.type==="number"){Q.type=J.type;break}break;case"NO_VALIDATION":case 0:Q.type=0;break;case"VALIDATE_GENERATED_CRC":case 1:Q.type=1;break;case"VALIDATE_SHA256":case 2:Q.type=2;break;case"VALIDATE_ECDSA_P256_SHA256":case 3:Q.type=3;break}if(J.bytes!=null){if(typeof J.bytes==="string")H.base64.decode(J.bytes,Q.bytes=H.newBuffer(H.base64.length(J.bytes)),0);else if(J.bytes.length>=0)Q.bytes=J.bytes}return Q},G.toObject=function Y(J,Q){if(!Q)Q={};let T={};if(Q.defaults){if(T.type=Q.enums===String?"NO_VALIDATION":0,Q.bytes===String)T.bytes="";else if(T.bytes=[],Q.bytes!==Array)T.bytes=H.newBuffer(T.bytes)}if(J.type!=null&&J.hasOwnProperty("type"))T.type=Q.enums===String?q.dfu.ValidationType[J.type]===void 0?J.type:q.dfu.ValidationType[J.type]:J.type;if(J.bytes!=null&&J.hasOwnProperty("bytes"))T.bytes=Q.bytes===String?H.base64.encode(J.bytes,0,J.bytes.length):Q.bytes===Array?Array.prototype.slice.call(J.bytes):J.bytes;return T},G.prototype.toJSON=function Y(){return this.constructor.toObject(this,I.util.toJSONOptions)},G.getTypeUrl=function Y(J){if(J===void 0)J="type.googleapis.com";return J+"/dfu.BootValidation"},G}(),X.InitCommand=function(){function G(Y){if(this.sdReq=[],this.bootValidation=[],Y){for(let J=Object.keys(Y),Q=0;Q<J.length;++Q)if(Y[J[Q]]!=null)this[J[Q]]=Y[J[Q]]}}return G.prototype.fwVersion=0,G.prototype.hwVersion=0,G.prototype.sdReq=H.emptyArray,G.prototype.type=0,G.prototype.sdSize=0,G.prototype.blSize=0,G.prototype.appSize=0,G.prototype.hash=null,G.prototype.isDebug=!1,G.prototype.bootValidation=H.emptyArray,G.create=function Y(J){return new G(J)},G.encode=function Y(J,Q){if(!Q)Q=w.create();if(J.fwVersion!=null&&Object.hasOwnProperty.call(J,"fwVersion"))Q.uint32(8).uint32(J.fwVersion);if(J.hwVersion!=null&&Object.hasOwnProperty.call(J,"hwVersion"))Q.uint32(16).uint32(J.hwVersion);if(J.sdReq!=null&&J.sdReq.length){Q.uint32(26).fork();for(let T=0;T<J.sdReq.length;++T)Q.uint32(J.sdReq[T]);Q.ldelim()}if(J.type!=null&&Object.hasOwnProperty.call(J,"type"))Q.uint32(32).int32(J.type);if(J.sdSize!=null&&Object.hasOwnProperty.call(J,"sdSize"))Q.uint32(40).uint32(J.sdSize);if(J.blSize!=null&&Object.hasOwnProperty.call(J,"blSize"))Q.uint32(48).uint32(J.blSize);if(J.appSize!=null&&Object.hasOwnProperty.call(J,"appSize"))Q.uint32(56).uint32(J.appSize);if(J.hash!=null&&Object.hasOwnProperty.call(J,"hash"))q.dfu.Hash.encode(J.hash,Q.uint32(66).fork()).ldelim();if(J.isDebug!=null&&Object.hasOwnProperty.call(J,"isDebug"))Q.uint32(72).bool(J.isDebug);if(J.bootValidation!=null&&J.bootValidation.length)for(let T=0;T<J.bootValidation.length;++T)q.dfu.BootValidation.encode(J.bootValidation[T],Q.uint32(82).fork()).ldelim();return Q},G.encodeDelimited=function Y(J,Q){return this.encode(J,Q).ldelim()},G.decode=function Y(J,Q){if(!(J instanceof F))J=F.create(J);let T=Q===void 0?J.len:J.pos+Q,Z=new q.dfu.InitCommand;while(J.pos<T){let N=J.uint32();switch(N>>>3){case 1:{Z.fwVersion=J.uint32();break}case 2:{Z.hwVersion=J.uint32();break}case 3:{if(!(Z.sdReq&&Z.sdReq.length))Z.sdReq=[];if((N&7)===2){let M=J.uint32()+J.pos;while(J.pos<M)Z.sdReq.push(J.uint32())}else Z.sdReq.push(J.uint32());break}case 4:{Z.type=J.int32();break}case 5:{Z.sdSize=J.uint32();break}case 6:{Z.blSize=J.uint32();break}case 7:{Z.appSize=J.uint32();break}case 8:{Z.hash=q.dfu.Hash.decode(J,J.uint32());break}case 9:{Z.isDebug=J.bool();break}case 10:{if(!(Z.bootValidation&&Z.bootValidation.length))Z.bootValidation=[];Z.bootValidation.push(q.dfu.BootValidation.decode(J,J.uint32()));break}default:J.skipType(N&7);break}}return Z},G.decodeDelimited=function Y(J){if(!(J instanceof F))J=new F(J);return this.decode(J,J.uint32())},G.verify=function Y(J){if(typeof J!=="object"||J===null)return"object expected";if(J.fwVersion!=null&&J.hasOwnProperty("fwVersion")){if(!H.isInteger(J.fwVersion))return"fwVersion: integer expected"}if(J.hwVersion!=null&&J.hasOwnProperty("hwVersion")){if(!H.isInteger(J.hwVersion))return"hwVersion: integer expected"}if(J.sdReq!=null&&J.hasOwnProperty("sdReq")){if(!Array.isArray(J.sdReq))return"sdReq: array expected";for(let Q=0;Q<J.sdReq.length;++Q)if(!H.isInteger(J.sdReq[Q]))return"sdReq: integer[] expected"}if(J.type!=null&&J.hasOwnProperty("type"))switch(J.type){default:return"type: enum value expected";case 0:case 1:case 2:case 3:case 4:break}if(J.sdSize!=null&&J.hasOwnProperty("sdSize")){if(!H.isInteger(J.sdSize))return"sdSize: integer expected"}if(J.blSize!=null&&J.hasOwnProperty("blSize")){if(!H.isInteger(J.blSize))return"blSize: integer expected"}if(J.appSize!=null&&J.hasOwnProperty("appSize")){if(!H.isInteger(J.appSize))return"appSize: integer expected"}if(J.hash!=null&&J.hasOwnProperty("hash")){let Q=q.dfu.Hash.verify(J.hash);if(Q)return"hash."+Q}if(J.isDebug!=null&&J.hasOwnProperty("isDebug")){if(typeof J.isDebug!=="boolean")return"isDebug: boolean expected"}if(J.bootValidation!=null&&J.hasOwnProperty("bootValidation")){if(!Array.isArray(J.bootValidation))return"bootValidation: array expected";for(let Q=0;Q<J.bootValidation.length;++Q){let T=q.dfu.BootValidation.verify(J.bootValidation[Q]);if(T)return"bootValidation."+T}}return null},G.fromObject=function Y(J){if(J instanceof q.dfu.InitCommand)return J;let Q=new q.dfu.InitCommand;if(J.fwVersion!=null)Q.fwVersion=J.fwVersion>>>0;if(J.hwVersion!=null)Q.hwVersion=J.hwVersion>>>0;if(J.sdReq){if(!Array.isArray(J.sdReq))throw TypeError(".dfu.InitCommand.sdReq: array expected");Q.sdReq=[];for(let T=0;T<J.sdReq.length;++T)Q.sdReq[T]=J.sdReq[T]>>>0}switch(J.type){default:if(typeof J.type==="number"){Q.type=J.type;break}break;case"APPLICATION":case 0:Q.type=0;break;case"SOFTDEVICE":case 1:Q.type=1;break;case"BOOTLOADER":case 2:Q.type=2;break;case"SOFTDEVICE_BOOTLOADER":case 3:Q.type=3;break;case"EXTERNAL_APPLICATION":case 4:Q.type=4;break}if(J.sdSize!=null)Q.sdSize=J.sdSize>>>0;if(J.blSize!=null)Q.blSize=J.blSize>>>0;if(J.appSize!=null)Q.appSize=J.appSize>>>0;if(J.hash!=null){if(typeof J.hash!=="object")throw TypeError(".dfu.InitCommand.hash: object expected");Q.hash=q.dfu.Hash.fromObject(J.hash)}if(J.isDebug!=null)Q.isDebug=Boolean(J.isDebug);if(J.bootValidation){if(!Array.isArray(J.bootValidation))throw TypeError(".dfu.InitCommand.bootValidation: array expected");Q.bootValidation=[];for(let T=0;T<J.bootValidation.length;++T){if(typeof J.bootValidation[T]!=="object")throw TypeError(".dfu.InitCommand.bootValidation: object expected");Q.bootValidation[T]=q.dfu.BootValidation.fromObject(J.bootValidation[T])}}return Q},G.toObject=function Y(J,Q){if(!Q)Q={};let T={};if(Q.arrays||Q.defaults)T.sdReq=[],T.bootValidation=[];if(Q.defaults)T.fwVersion=0,T.hwVersion=0,T.type=Q.enums===String?"APPLICATION":0,T.sdSize=0,T.blSize=0,T.appSize=0,T.hash=null,T.isDebug=!1;if(J.fwVersion!=null&&J.hasOwnProperty("fwVersion"))T.fwVersion=J.fwVersion;if(J.hwVersion!=null&&J.hasOwnProperty("hwVersion"))T.hwVersion=J.hwVersion;if(J.sdReq&&J.sdReq.length){T.sdReq=[];for(let Z=0;Z<J.sdReq.length;++Z)T.sdReq[Z]=J.sdReq[Z]}if(J.type!=null&&J.hasOwnProperty("type"))T.type=Q.enums===String?q.dfu.FwType[J.type]===void 0?J.type:q.dfu.FwType[J.type]:J.type;if(J.sdSize!=null&&J.hasOwnProperty("sdSize"))T.sdSize=J.sdSize;if(J.blSize!=null&&J.hasOwnProperty("blSize"))T.blSize=J.blSize;if(J.appSize!=null&&J.hasOwnProperty("appSize"))T.appSize=J.appSize;if(J.hash!=null&&J.hasOwnProperty("hash"))T.hash=q.dfu.Hash.toObject(J.hash,Q);if(J.isDebug!=null&&J.hasOwnProperty("isDebug"))T.isDebug=J.isDebug;if(J.bootValidation&&J.bootValidation.length){T.bootValidation=[];for(let Z=0;Z<J.bootValidation.length;++Z)T.bootValidation[Z]=q.dfu.BootValidation.toObject(J.bootValidation[Z],Q)}return T},G.prototype.toJSON=function Y(){return this.constructor.toObject(this,I.util.toJSONOptions)},G.getTypeUrl=function Y(J){if(J===void 0)J="type.googleapis.com";return J+"/dfu.InitCommand"},G}(),X.ResetCommand=function(){function G(Y){if(Y){for(let J=Object.keys(Y),Q=0;Q<J.length;++Q)if(Y[J[Q]]!=null)this[J[Q]]=Y[J[Q]]}}return G.prototype.timeout=0,G.create=function Y(J){return new G(J)},G.encode=function Y(J,Q){if(!Q)Q=w.create();return Q.uint32(8).uint32(J.timeout),Q},G.encodeDelimited=function Y(J,Q){return this.encode(J,Q).ldelim()},G.decode=function Y(J,Q){if(!(J instanceof F))J=F.create(J);let T=Q===void 0?J.len:J.pos+Q,Z=new q.dfu.ResetCommand;while(J.pos<T){let N=J.uint32();switch(N>>>3){case 1:{Z.timeout=J.uint32();break}default:J.skipType(N&7);break}}if(!Z.hasOwnProperty("timeout"))throw H.ProtocolError("missing required 'timeout'",{instance:Z});return Z},G.decodeDelimited=function Y(J){if(!(J instanceof F))J=new F(J);return this.decode(J,J.uint32())},G.verify=function Y(J){if(typeof J!=="object"||J===null)return"object expected";if(!H.isInteger(J.timeout))return"timeout: integer expected";return null},G.fromObject=function Y(J){if(J instanceof q.dfu.ResetCommand)return J;let Q=new q.dfu.ResetCommand;if(J.timeout!=null)Q.timeout=J.timeout>>>0;return Q},G.toObject=function Y(J,Q){if(!Q)Q={};let T={};if(Q.defaults)T.timeout=0;if(J.timeout!=null&&J.hasOwnProperty("timeout"))T.timeout=J.timeout;return T},G.prototype.toJSON=function Y(){return this.constructor.toObject(this,I.util.toJSONOptions)},G.getTypeUrl=function Y(J){if(J===void 0)J="type.googleapis.com";return J+"/dfu.ResetCommand"},G}(),X.Command=function(){function G(Y){if(Y){for(let J=Object.keys(Y),Q=0;Q<J.length;++Q)if(Y[J[Q]]!=null)this[J[Q]]=Y[J[Q]]}}return G.prototype.opCode=0,G.prototype.init=null,G.prototype.reset=null,G.create=function Y(J){return new G(J)},G.encode=function Y(J,Q){if(!Q)Q=w.create();if(J.opCode!=null&&Object.hasOwnProperty.call(J,"opCode"))Q.uint32(8).int32(J.opCode);if(J.init!=null&&Object.hasOwnProperty.call(J,"init"))q.dfu.InitCommand.encode(J.init,Q.uint32(18).fork()).ldelim();if(J.reset!=null&&Object.hasOwnProperty.call(J,"reset"))q.dfu.ResetCommand.encode(J.reset,Q.uint32(26).fork()).ldelim();return Q},G.encodeDelimited=function Y(J,Q){return this.encode(J,Q).ldelim()},G.decode=function Y(J,Q){if(!(J instanceof F))J=F.create(J);let T=Q===void 0?J.len:J.pos+Q,Z=new q.dfu.Command;while(J.pos<T){let N=J.uint32();switch(N>>>3){case 1:{Z.opCode=J.int32();break}case 2:{Z.init=q.dfu.InitCommand.decode(J,J.uint32());break}case 3:{Z.reset=q.dfu.ResetCommand.decode(J,J.uint32());break}default:J.skipType(N&7);break}}return Z},G.decodeDelimited=function Y(J){if(!(J instanceof F))J=new F(J);return this.decode(J,J.uint32())},G.verify=function Y(J){if(typeof J!=="object"||J===null)return"object expected";if(J.opCode!=null&&J.hasOwnProperty("opCode"))switch(J.opCode){default:return"opCode: enum value expected";case 0:case 1:break}if(J.init!=null&&J.hasOwnProperty("init")){let Q=q.dfu.InitCommand.verify(J.init);if(Q)return"init."+Q}if(J.reset!=null&&J.hasOwnProperty("reset")){let Q=q.dfu.ResetCommand.verify(J.reset);if(Q)return"reset."+Q}return null},G.fromObject=function Y(J){if(J instanceof q.dfu.Command)return J;let Q=new q.dfu.Command;switch(J.opCode){default:if(typeof J.opCode==="number"){Q.opCode=J.opCode;break}break;case"RESET":case 0:Q.opCode=0;break;case"INIT":case 1:Q.opCode=1;break}if(J.init!=null){if(typeof J.init!=="object")throw TypeError(".dfu.Command.init: object expected");Q.init=q.dfu.InitCommand.fromObject(J.init)}if(J.reset!=null){if(typeof J.reset!=="object")throw TypeError(".dfu.Command.reset: object expected");Q.reset=q.dfu.ResetCommand.fromObject(J.reset)}return Q},G.toObject=function Y(J,Q){if(!Q)Q={};let T={};if(Q.defaults)T.opCode=Q.enums===String?"RESET":0,T.init=null,T.reset=null;if(J.opCode!=null&&J.hasOwnProperty("opCode"))T.opCode=Q.enums===String?q.dfu.OpCode[J.opCode]===void 0?J.opCode:q.dfu.OpCode[J.opCode]:J.opCode;if(J.init!=null&&J.hasOwnProperty("init"))T.init=q.dfu.InitCommand.toObject(J.init,Q);if(J.reset!=null&&J.hasOwnProperty("reset"))T.reset=q.dfu.ResetCommand.toObject(J.reset,Q);return T},G.prototype.toJSON=function Y(){return this.constructor.toObject(this,I.util.toJSONOptions)},G.getTypeUrl=function Y(J){if(J===void 0)J="type.googleapis.com";return J+"/dfu.Command"},G}(),X.SignatureType=function(){const G={},Y=Object.create(G);return Y[G[0]="ECDSA_P256_SHA256"]=0,Y[G[1]="ED25519"]=1,Y}(),X.SignedCommand=function(){function G(Y){if(Y){for(let J=Object.keys(Y),Q=0;Q<J.length;++Q)if(Y[J[Q]]!=null)this[J[Q]]=Y[J[Q]]}}return G.prototype.command=null,G.prototype.signatureType=0,G.prototype.signature=H.newBuffer([]),G.create=function Y(J){return new G(J)},G.encode=function Y(J,Q){if(!Q)Q=w.create();return q.dfu.Command.encode(J.command,Q.uint32(10).fork()).ldelim(),Q.uint32(16).int32(J.signatureType),Q.uint32(26).bytes(J.signature),Q},G.encodeDelimited=function Y(J,Q){return this.encode(J,Q).ldelim()},G.decode=function Y(J,Q){if(!(J instanceof F))J=F.create(J);let T=Q===void 0?J.len:J.pos+Q,Z=new q.dfu.SignedCommand;while(J.pos<T){let N=J.uint32();switch(N>>>3){case 1:{Z.command=q.dfu.Command.decode(J,J.uint32());break}case 2:{Z.signatureType=J.int32();break}case 3:{Z.signature=J.bytes();break}default:J.skipType(N&7);break}}if(!Z.hasOwnProperty("command"))throw H.ProtocolError("missing required 'command'",{instance:Z});if(!Z.hasOwnProperty("signatureType"))throw H.ProtocolError("missing required 'signatureType'",{instance:Z});if(!Z.hasOwnProperty("signature"))throw H.ProtocolError("missing required 'signature'",{instance:Z});return Z},G.decodeDelimited=function Y(J){if(!(J instanceof F))J=new F(J);return this.decode(J,J.uint32())},G.verify=function Y(J){if(typeof J!=="object"||J===null)return"object expected";{let Q=q.dfu.Command.verify(J.command);if(Q)return"command."+Q}switch(J.signatureType){default:return"signatureType: enum value expected";case 0:case 1:break}if(!(J.signature&&typeof J.signature.length==="number"||H.isString(J.signature)))return"signature: buffer expected";return null},G.fromObject=function Y(J){if(J instanceof q.dfu.SignedCommand)return J;let Q=new q.dfu.SignedCommand;if(J.command!=null){if(typeof J.command!=="object")throw TypeError(".dfu.SignedCommand.command: object expected");Q.command=q.dfu.Command.fromObject(J.command)}switch(J.signatureType){default:if(typeof J.signatureType==="number"){Q.signatureType=J.signatureType;break}break;case"ECDSA_P256_SHA256":case 0:Q.signatureType=0;break;case"ED25519":case 1:Q.signatureType=1;break}if(J.signature!=null){if(typeof J.signature==="string")H.base64.decode(J.signature,Q.signature=H.newBuffer(H.base64.length(J.signature)),0);else if(J.signature.length>=0)Q.signature=J.signature}return Q},G.toObject=function Y(J,Q){if(!Q)Q={};let T={};if(Q.defaults){if(T.command=null,T.signatureType=Q.enums===String?"ECDSA_P256_SHA256":0,Q.bytes===String)T.signature="";else if(T.signature=[],Q.bytes!==Array)T.signature=H.newBuffer(T.signature)}if(J.command!=null&&J.hasOwnProperty("command"))T.command=q.dfu.Command.toObject(J.command,Q);if(J.signatureType!=null&&J.hasOwnProperty("signatureType"))T.signatureType=Q.enums===String?q.dfu.SignatureType[J.signatureType]===void 0?J.signatureType:q.dfu.SignatureType[J.signatureType]:J.signatureType;if(J.signature!=null&&J.hasOwnProperty("signature"))T.signature=Q.bytes===String?H.base64.encode(J.signature,0,J.signature.length):Q.bytes===Array?Array.prototype.slice.call(J.signature):J.signature;return T},G.prototype.toJSON=function Y(){return this.constructor.toObject(this,I.util.toJSONOptions)},G.getTypeUrl=function Y(J){if(J===void 0)J="type.googleapis.com";return J+"/dfu.SignedCommand"},G}(),X.Packet=function(){function G(Y){if(Y){for(let J=Object.keys(Y),Q=0;Q<J.length;++Q)if(Y[J[Q]]!=null)this[J[Q]]=Y[J[Q]]}}return G.prototype.command=null,G.prototype.signedCommand=null,G.create=function Y(J){return new G(J)},G.encode=function Y(J,Q){if(!Q)Q=w.create();if(J.command!=null&&Object.hasOwnProperty.call(J,"command"))q.dfu.Command.encode(J.command,Q.uint32(10).fork()).ldelim();if(J.signedCommand!=null&&Object.hasOwnProperty.call(J,"signedCommand"))q.dfu.SignedCommand.encode(J.signedCommand,Q.uint32(18).fork()).ldelim();return Q},G.encodeDelimited=function Y(J,Q){return this.encode(J,Q).ldelim()},G.decode=function Y(J,Q){if(!(J instanceof F))J=F.create(J);let T=Q===void 0?J.len:J.pos+Q,Z=new q.dfu.Packet;while(J.pos<T){let N=J.uint32();switch(N>>>3){case 1:{Z.command=q.dfu.Command.decode(J,J.uint32());break}case 2:{Z.signedCommand=q.dfu.SignedCommand.decode(J,J.uint32());break}default:J.skipType(N&7);break}}return Z},G.decodeDelimited=function Y(J){if(!(J instanceof F))J=new F(J);return this.decode(J,J.uint32())},G.verify=function Y(J){if(typeof J!=="object"||J===null)return"object expected";if(J.command!=null&&J.hasOwnProperty("command")){let Q=q.dfu.Command.verify(J.command);if(Q)return"command."+Q}if(J.signedCommand!=null&&J.hasOwnProperty("signedCommand")){let Q=q.dfu.SignedCommand.verify(J.signedCommand);if(Q)return"signedCommand."+Q}return null},G.fromObject=function Y(J){if(J instanceof q.dfu.Packet)return J;let Q=new q.dfu.Packet;if(J.command!=null){if(typeof J.command!=="object")throw TypeError(".dfu.Packet.command: object expected");Q.command=q.dfu.Command.fromObject(J.command)}if(J.signedCommand!=null){if(typeof J.signedCommand!=="object")throw TypeError(".dfu.Packet.signedCommand: object expected");Q.signedCommand=q.dfu.SignedCommand.fromObject(J.signedCommand)}return Q},G.toObject=function Y(J,Q){if(!Q)Q={};let T={};if(Q.defaults)T.command=null,T.signedCommand=null;if(J.command!=null&&J.hasOwnProperty("command"))T.command=q.dfu.Command.toObject(J.command,Q);if(J.signedCommand!=null&&J.hasOwnProperty("signedCommand"))T.signedCommand=q.dfu.SignedCommand.toObject(J.signedCommand,Q);return T},G.prototype.toJSON=function Y(){return this.constructor.toObject(this,I.util.toJSONOptions)},G.getTypeUrl=function Y(J){if(J===void 0)J="type.googleapis.com";return J+"/dfu.Packet"},G}(),X})();var j=function(X){if(X)throw Error(X)};function T0({firmwareHash:X,appSize:G,privateKey:Y,fwVersion:J,hwVersion:Q,sdReq:T,isDebug:Z=!1,verify:N=!0}){const M=V.Hash.create({hashType:V.HashType.SHA256,hash:X});if(N)j(V.Hash.verify(M));const D=V.BootValidation.create({type:V.ValidationType.VALIDATE_GENERATED_CRC,bytes:c8.alloc(0)});if(N)j(V.BootValidation.verify(D));const K={type:V.FwType.APPLICATION,fwVersion:J,hwVersion:Q,sdReq:T,appSize:G,isDebug:Z,hash:M,bootValidation:[D]};if(N)j(V.InitCommand.verify(K));const z=V.InitCommand.create(K),W={opCode:V.OpCode.INIT,init:z};if(N)j(V.Command.verify(W));const b=V.Command.create(W),F8=V.Command.encode(b).finish().subarray(4),E8=F0(F8,Y),Z0={command:b,signatureType:V.SignatureType.ECDSA_P256_SHA256,signature:E8};if(N)j(V.SignedCommand.verify(Z0));const M0={signedCommand:V.SignedCommand.create(Z0)};if(N)j(V.Packet.verify(M0));const N0=V.Packet.create(M0);if(N)j(V.Packet.verify(N0));return V.Packet.encode(N0).finish()}var S8={manifest:{application:{bin_file:"firmware.bin",dat_file:"initpacket.dat"}}};function n8({firmware:X,pattern:G,privateKey:Y,fwVersion:J,hwVersion:Q,sdReq:T,verify:Z,isDebug:N}){const M=K0(),D=H0(M),K=V0(X,D,G),z=K.byteLength,W=S0(K),b=T0({firmwareHash:W,appSize:z,privateKey:Y,fwVersion:J,hwVersion:Q,sdReq:T,verify:Z,isDebug:N});return{manifest:S8,initPacket:b,firmwarePatched:K,privateKeyForAccessory:M}}export{n8 as default};
